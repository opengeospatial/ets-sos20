<?xml version="1.0" encoding="UTF-8"?>
<ctl:package 
	xmlns:sosFunctions="http://www.opengis.net/sos/2.0"	
	xmlns:owsTests="http://www.opengis.net/ows/1.1"
	xmlns:ctl="http://www.occamlab.com/ctl" 
	xmlns:xsd="http://www.w3.org/2001/XMLSchema"
	xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
	xmlns:fes="http://www.opengis.net/fes/2.0"
	xmlns:gml="http://www.opengis.net/gml/3.2" 
	xmlns:om="http://www.opengis.net/om/2.0"
	xmlns:ows="http://www.opengis.net/ows/1.1" 
	xmlns:soap11="http://schemas.xmlsoap.org/soap/" 
	xmlns:soap12="http://www.w3.org/2003/05/soap-envelope" 	
	xmlns:sos="http://www.opengis.net/sos/2.0"	
	xmlns:swe="http://www.opengis.net/swe/2.0"	
	xmlns:swes="http://www.opengis.net/swes/2.0"	
	xmlns:wsa="http://www.w3.org/2005/08/addressing"	
	xmlns:xs="http://www.w3.org/2001/XMLSchema"
	xmlns:xlink="http://www.w3.org/1999/xlink"
	xmlns:parsers="http://www.occamlab.com/te/parsers"
>
	<ctl:suite name="sos:suite">
		<ctl:title>SOS 2.0 Compliance Test Suite</ctl:title>
		<ctl:description>Verifies that an SOS 2.0 implementation complies with a given conformance class.</ctl:description>
		<ctl:link></ctl:link>		
		<ctl:starting-test>sos:Main</ctl:starting-test>
	</ctl:suite>

	<ctl:test name="sos:Main">
		<ctl:assertion>The IUT satisfies all applicable assertions.</ctl:assertion>
		<ctl:code>
			<!-- User Input Form -->
			<xsl:variable name="form-values">
				<ctl:form height="750" width="1024">
					<body>
						<h2 align="center">Compliance test suite for Sensor Observation Service (SOS) 2.0</h2>
						<h3 align="center">Service metadata and test options</h3>
						<p>Please provide a URL from which a capabilities document can be retrieved. </p>
						<p>Modify the URL template below to specify the location of an OGC SOS implementation under test.</p>	
						<blockquote>
							<table border="1" padding="4" bgcolor="#00ffff" align="center">
								<tr>
									<td align="left">Service URL:</td>                        
									<td align="center">
										<input name="service-url" size="128" 
										type="text" 
										value=""/>
									</td>
								</tr>				
							</table>
						</blockquote>
						<p>Please select how tho send this request.</p>
						<blockquote>
							<table border="1" padding="4" bgcolor="#00ffff" align="center">
								<tr>
									<td><input type="radio" name="request-via" checked="true" value="GET">HTTP Get</input></td>
									<td><input type="radio" name="request-via" value="POST">HTTP Post</input></td>
									<td><input type="radio" name="request-via" value="SOAP">SOAP Binding</input></td>
								</tr>				
							</table>						
						</blockquote>
						<p>Please select whether to run all tests or just selected tests.</p>
						<blockquote>
							<table border="1" padding="4" bgcolor="#00ffff" align="center">
								<tr>
									<td><input type="radio" name="which-tests" checked="true" value="all">Run all tests</input></td>
									<td><input type="radio" name="which-tests" value="selected">Run selected tests</input></td>
								</tr>				
							</table>						
						</blockquote>
						<p>If you want to run selected tests, please select the checkboxes for the tests you want to run.</p>
						<blockquote>
							<table border="1" padding="4" bgcolor="#00ffff" align="center">
								<tr><th colspan="4" align="left"><input type="checkbox" name="01">01.OWS Main</input></th></tr>
								<tr>
									<td><input type="checkbox" name="0101">01.01.OWS.ContentType.1</input></td>
									<td><input type="checkbox" name="0102">01.02.OWS.GetCapabilities-Exceptions.2</input></td>
									<td><input type="checkbox" name="0103">01.03.OWS.GetCapabilities-UpdateSequence.1</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0104">01.04.OWS.GetCapabilities-Exceptions.5</input></td>
									<td><input type="checkbox" name="0105">01.05.OWS.CaseInsensitiveKvpNames.1</input></td>
									<td><input type="checkbox" name="0106">01.06.OWS.GetCapabilities-AcceptVersions.1</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0107">01.07.OWS.GetCapabilities-AcceptVersions.2</input></td>
									<td><input type="checkbox" name="0108">01.08.OWS.GetCapabilities-AcceptVersions.3</input></td>
									<td><input type="checkbox" name="0109">01.09.OWS.GetCapabilities-Sections.1</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0110">01.10.OWS.GetCapabilities-Sections.2</input></td>
									<td><input type="checkbox" name="0111">01.11.OWS.GetCapabilities-AcceptFormats.1</input></td>
									<td>--</td>
								</tr>

								<tr><th colspan="4" align="left"><input type="checkbox" name="02">02.SOS General Main</input></th></tr>
								<tr>
									<td><input type="checkbox" name="0201">02.01.SOS.General-InvalidRequest.1</input></td>
									<td>--</td>
									<td>--</td>
								</tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="03">03.SOS Core: Get Capabilities</input></th></tr>
								<tr>
									<td><input type="checkbox" name="0301">03.01.CorrectServiceParameter</input></td>
									<td><input type="checkbox" name="0302">03.02.OperationMetadataMandatory</input></td>
									<td><input type="checkbox" name="0303">03.03.RequiredSectionsInCapabilities</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0304">03.04.WrongSectionParameter</input></td>
									<td><input type="checkbox" name="0305">03.05.BBOX</input></td>
									<td><input type="checkbox" name="0306">03.06.OperatorDuringAndTEquals</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0307">03.07.ParametersInObservationOffering</input></td>
									<td><input type="checkbox" name="0308">03.08.ResponseFormat</input></td>
									<td>--</td>
								</tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="04">04.SOS Core: DescribeSensor</input></th></tr>
								<tr>
									<td><input type="checkbox" name="0401">04.01.RequestNoService</input></td>
									<td><input type="checkbox" name="0402">04.02.RequestNullService</input></td>
									<td><input type="checkbox" name="0403">04.03.RequestInvalidService</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0404">04.04.RequestNoVersion</input></td>
									<td><input type="checkbox" name="0405">04.05.RequestNullVersion</input></td>
									<td><input type="checkbox" name="0406">04.06.RequestInvalidVersion</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0407">04.07.RequestNoProcedure</input></td>
									<td><input type="checkbox" name="0408">04.08.RequestNullProcedure</input></td>
									<td><input type="checkbox" name="0409">04.09.RequestInvalidProcedure</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0410">04.10.RequestNoProcedureDescriptionFormat</input></td>
									<td><input type="checkbox" name="0411">04.11.RequestNullProcedureDescriptionFormat</input></td>
									<td><input type="checkbox" name="0412">04.12.RequestInvalidProcedureDescriptionFormat</input></td>
								</tr>
								<tr>
									<td><input type="checkbox" name="0413">04.13.RequestNoValidTime</input></td>
									<td><input type="checkbox" name="0414">04.14.RequestValidRequest</input></td>
									<td>--</td>
								</tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="05">05.SOS Core: GetObservation</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="06">06.SOS enhancedOperations: GetFeatureOfInterest</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="07">07.SOS enhancedOperations: GetObservationById</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="08">08.SOS Transactional: InsertionCapabilities</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="09">09.SOS Transactional: InsertSensor</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="10">10.SOS Transactional: DeleteSensor</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="11">11.SOS Transactional: InsertObservation</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="12">12.SOS resultHandling: InsertResultTemplate</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="13">13.SOS resultHandling: InsertResult</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="14">14.SOS resultRetrieval: GetResultTemplate</input></th></tr>
								<tr><th colspan="4" align="left"><input type="checkbox" name="15">15.SOS resultRetrieval: GetResult</input></th></tr>
							</table>						
						</blockquote>

						<p>Please press the "Start" button to start testing.</p>
						<div align="center">
							<input type="submit" value="Start"/>						
						</div>
					</body>
				</ctl:form>
			</xsl:variable>

			<!-- Get user input, message user options -->	
			<xsl:variable name="capabilities-url" select="$form-values/values/value[@key='service-url']"/>
			<ctl:message select="concat('capabilities-url: ',$capabilities-url)"/>
			<xsl:variable name="request-via" select="$form-values/values/value[@key='request-via']"/>
			<ctl:message select="concat('request-via: ',$request-via)"/>
			<xsl:variable name="which-tests" select="$form-values/values/value[@key='which-tests']"/>
			<ctl:message select="concat('which tests: ',$which-tests)"/>
			<xsl:variable name="isSOAP" select="($request-via eq 'SOAP')"/>
			<ctl:message select="concat('Is SOAP Binding: ',$isSOAP)"/>
			<!-- Get capabilities, find url and method(GET or POST) for all operations -->
			<xsl:variable name="user-capabilities">
				<xsl:if test="($request-via eq 'GET')">
					<ctl:request>
						<ctl:url>
							<xsl:value-of select="$capabilities-url"/>
						</ctl:url>
						<ctl:method>get</ctl:method>
						<ctl:param name="request">GetCapabilities</ctl:param>
					</ctl:request>
				</xsl:if>
				<xsl:if test="($request-via eq 'POST')">
					<ctl:request>
						<ctl:url>
							<xsl:value-of select="$capabilities-url" />
						</ctl:url>
						<ctl:method>post</ctl:method>
						<ctl:body>
							<sos:GetCapabilities service="SOS" xmlns:sos="http://www.opengis.net/sos/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
								xsi:schemaLocation="http://www.w3.org/2003/05/soap-envelope http://www.w3.org/2003/05/soap-envelope/soap-envelope.xsd 
								http://www.opengis.net/sos/2.0 http://schemas.opengis.net/sos/2.0/sos.xsd"/>
						</ctl:body>
					</ctl:request>
				</xsl:if>
				<xsl:if test="($request-via eq 'SOAP')">
					<ctl:soap-request version="1.2" charset="UTF-8">
						<ctl:url>
							<xsl:value-of select="$capabilities-url"/>
						</ctl:url>
						<ctl:body>
							<sos:GetCapabilities service="SOS" xmlns:sos="http://www.opengis.net/sos/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
								xsi:schemaLocation="http://www.w3.org/2003/05/soap-envelope http://www.w3.org/2003/05/soap-envelope/soap-envelope.xsd 
								http://www.opengis.net/sos/2.0 http://schemas.opengis.net/sos/2.0/sos.xsd"
								xmlns:soap12="http://www.w3.org/2003/05/soap-envelope" ></sos:GetCapabilities>
						</ctl:body>
						<ctl:call-function name="sosFunctions:validateGetCapabilitiesResponseSOAP" />
					</ctl:soap-request>
				</xsl:if>
			</xsl:variable>
			<xsl:choose>
				<xsl:when test="not($user-capabilities/*)">
					<ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
					<ctl:fail/>
				</xsl:when>
				<xsl:otherwise>
					<!-- Set Operations's URL -->
					<xsl:variable name="IsGetCapabilities-GET" select="count($user-capabilities//ows:Operation[@name='GetCapabilities']//ows:Get) > 0" />
					<xsl:variable name="GetCapabilities-URL">
						<xsl:if test="$IsGetCapabilities-GET">
							<xsl:value-of select="$user-capabilities//ows:Operation[@name='GetCapabilities']//ows:Get/@xlink:href"/>
						</xsl:if>
						<xsl:if test="not($IsGetCapabilities-GET)">
							<xsl:value-of select="$user-capabilities//ows:Operation[@name='GetCapabilities']//ows:Post/@xlink:href"/>
						</xsl:if>
					</xsl:variable>
					<xsl:variable name="IsDescribeSensor-GET" select="count($user-capabilities//ows:Operation[@name='DescribeSensor']//ows:Get) > 0" />
					<xsl:variable name="DescribeSensor-URL">
						<xsl:if test="$IsDescribeSensor-GET">
							<xsl:value-of select="$user-capabilities//ows:Operation[@name='DescribeSensor']//ows:Get/@xlink:href"/>
						</xsl:if>
						<xsl:if test="not($IsDescribeSensor-GET)">
							<xsl:value-of select="$user-capabilities//ows:Operation[@name='DescribeSensor']//ows:Post/@xlink:href"/>
						</xsl:if>
					</xsl:variable>
					<xsl:variable name="IsGetObservation-GET" select="count($user-capabilities//ows:Operation[@name='GetObservation']//ows:Get) > 0" />
					<xsl:variable name="GetObservation-URL">
						<xsl:if test="$IsGetObservation-GET">
							<xsl:value-of select="$user-capabilities//ows:Operation[@name='GetObservation']//ows:Get/@xlink:href"/>
						</xsl:if>
						<xsl:if test="not($IsGetObservation-GET)">
							<xsl:value-of select="$user-capabilities//ows:Operation[@name='GetObservation']//ows:Post/@xlink:href"/>
						</xsl:if>
					</xsl:variable>

					<!-- Set selected tests.-->
					<xsl:variable name="t01" select="$form-values/values/value[@key='01']"/>
					<xsl:variable name="t0101" select="$form-values/values/value[@key='0101']"/>
					<xsl:variable name="test0101" select="($which-tests eq 'all' or $t01 eq 'on' or $t0101 eq 'on' )"/>
					<xsl:variable name="t0102" select="$form-values/values/value[@key='0102']"/>
					<xsl:variable name="test0102" select="($which-tests eq 'all' or $t01 eq 'on' or $t0102 eq 'on' )"/>
					<xsl:variable name="t0103" select="$form-values/values/value[@key='0103']"/>
					<xsl:variable name="test0103" select="($which-tests eq 'all' or $t01 eq 'on' or $t0103 eq 'on' )"/>
					<xsl:variable name="t0104" select="$form-values/values/value[@key='0104']"/>
					<xsl:variable name="test0104" select="($which-tests eq 'all' or $t01 eq 'on' or $t0104 eq 'on' )"/>
					<xsl:variable name="t0105" select="$form-values/values/value[@key='0105']"/>
					<xsl:variable name="test0105" select="($which-tests eq 'all' or $t01 eq 'on' or $t0105 eq 'on' )"/>
					<xsl:variable name="t0106" select="$form-values/values/value[@key='0106']"/>
					<xsl:variable name="test0106" select="($which-tests eq 'all' or $t01 eq 'on' or $t0106 eq 'on' )"/>
					<xsl:variable name="t0107" select="$form-values/values/value[@key='0107']"/>
					<xsl:variable name="test0107" select="($which-tests eq 'all' or $t01 eq 'on' or $t0107 eq 'on' )"/>
					<xsl:variable name="t0108" select="$form-values/values/value[@key='0108']"/>
					<xsl:variable name="test0108" select="($which-tests eq 'all' or $t01 eq 'on' or $t0108 eq 'on' )"/>
					<xsl:variable name="t0109" select="$form-values/values/value[@key='0109']"/>
					<xsl:variable name="test0109" select="($which-tests eq 'all' or $t01 eq 'on' or $t0109 eq 'on' )"/>
					<xsl:variable name="t0110" select="$form-values/values/value[@key='0110']"/>
					<xsl:variable name="test0110" select="($which-tests eq 'all' or $t01 eq 'on' or $t0110 eq 'on' )"/>
					<xsl:variable name="t0111" select="$form-values/values/value[@key='0111']"/>
					<xsl:variable name="test0111" select="($which-tests eq 'all' or $t01 eq 'on' or $t0111 eq 'on' )"/>
					<xsl:variable name="test01" select="$test0101 or $test0102 or $test0103 or $test0104 or $test0105 or $test0106 or $test0107 or $test0108 or $test0109 or $test0110 or $test0111"/><!-- all test in 01-->
					
					<xsl:variable name="t02" select="$form-values/values/value[@key='02']"/>
					<xsl:variable name="t0201" select="$form-values/values/value[@key='0201']"/>
					<xsl:variable name="test0201" select="($which-tests eq 'all' or $t02 eq 'on' or $t0201 eq 'on')"/>
					<xsl:variable name="test02" select="$test0201"/><!-- all test in 02-->

					<xsl:variable name="t03" select="$form-values/values/value[@key='03']"/>
					<xsl:variable name="t0301" select="$form-values/values/value[@key='0301']"/>
					<xsl:variable name="test0301" select="($which-tests eq 'all' or $t03 eq 'on' or $t0301 eq 'on')"/>
					<xsl:variable name="t0302" select="$form-values/values/value[@key='0302']"/>
					<xsl:variable name="test0302" select="($which-tests eq 'all' or $t03 eq 'on' or $t0302 eq 'on')"/>
					<xsl:variable name="t0303" select="$form-values/values/value[@key='0303']"/>
					<xsl:variable name="test0303" select="($which-tests eq 'all' or $t03 eq 'on' or $t0303 eq 'on')"/>
					<xsl:variable name="t0304" select="$form-values/values/value[@key='0304']"/>
					<xsl:variable name="test0304" select="($which-tests eq 'all' or $t03 eq 'on' or $t0304 eq 'on')"/>
					<xsl:variable name="t0305" select="$form-values/values/value[@key='0305']"/>
					<xsl:variable name="test0305" select="($which-tests eq 'all' or $t03 eq 'on' or $t0305 eq 'on')"/>
					<xsl:variable name="t0306" select="$form-values/values/value[@key='0306']"/>
					<xsl:variable name="test0306" select="($which-tests eq 'all' or $t03 eq 'on' or $t0306 eq 'on')"/>
					<xsl:variable name="t0307" select="$form-values/values/value[@key='0307']"/>
					<xsl:variable name="test0307" select="($which-tests eq 'all' or $t03 eq 'on' or $t0307 eq 'on')"/>
					<xsl:variable name="t0308" select="$form-values/values/value[@key='0308']"/>
					<xsl:variable name="test0308" select="($which-tests eq 'all' or $t03 eq 'on' or $t0308 eq 'on')"/>
					<xsl:variable name="test03" select="$test0301 or $test0302 or $test0303 or $test0304 or $test0305 or $test0306 or $test0307 or $test0308"/><!-- all test in 03-->

					<xsl:variable name="t04" select="$form-values/values/value[@key='04']"/>
					<xsl:variable name="t0401" select="$form-values/values/value[@key='0401']"/>
					<xsl:variable name="test0401" select="($which-tests eq 'all' or $t04 eq 'on' or $t0401 eq 'on')"/>
					<xsl:variable name="t0402" select="$form-values/values/value[@key='0402']"/>
					<xsl:variable name="test0402" select="($which-tests eq 'all' or $t04 eq 'on' or $t0402 eq 'on')"/>
					<xsl:variable name="t0403" select="$form-values/values/value[@key='0403']"/>
					<xsl:variable name="test0403" select="($which-tests eq 'all' or $t03 eq 'on' or $t0403 eq 'on')"/>
					<xsl:variable name="t0404" select="$form-values/values/value[@key='0404']"/>
					<xsl:variable name="test0404" select="($which-tests eq 'all' or $t04 eq 'on' or $t0404 eq 'on')"/>
					<xsl:variable name="t0405" select="$form-values/values/value[@key='0405']"/>
					<xsl:variable name="test0405" select="($which-tests eq 'all' or $t04 eq 'on' or $t0405 eq 'on')"/>
					<xsl:variable name="t0406" select="$form-values/values/value[@key='0406']"/>
					<xsl:variable name="test0406" select="($which-tests eq 'all' or $t04 eq 'on' or $t0406 eq 'on')"/>
					<xsl:variable name="t0407" select="$form-values/values/value[@key='0407']"/>
					<xsl:variable name="test0407" select="($which-tests eq 'all' or $t04 eq 'on' or $t0407 eq 'on')"/>
					<xsl:variable name="t0408" select="$form-values/values/value[@key='0408']"/>
					<xsl:variable name="test0408" select="($which-tests eq 'all' or $t04 eq 'on' or $t0408 eq 'on')"/>
					<xsl:variable name="t0409" select="$form-values/values/value[@key='0409']"/>
					<xsl:variable name="test0409" select="($which-tests eq 'all' or $t04 eq 'on' or $t0409 eq 'on')"/>
					<xsl:variable name="t0410" select="$form-values/values/value[@key='0410']"/>
					<xsl:variable name="test0410" select="($which-tests eq 'all' or $t04 eq 'on' or $t0410 eq 'on')"/>
					<xsl:variable name="t0411" select="$form-values/values/value[@key='0411']"/>
					<xsl:variable name="test0411" select="($which-tests eq 'all' or $t04 eq 'on' or $t0411 eq 'on')"/>
					<xsl:variable name="t0412" select="$form-values/values/value[@key='0412']"/>
					<xsl:variable name="test0412" select="($which-tests eq 'all' or $t04 eq 'on' or $t0412 eq 'on')"/>
					<xsl:variable name="t0413" select="$form-values/values/value[@key='0413']"/>
					<xsl:variable name="test0413" select="($which-tests eq 'all' or $t03 eq 'on' or $t0413 eq 'on')"/>
					<xsl:variable name="t0414" select="$form-values/values/value[@key='0414']"/>
					<xsl:variable name="test0414" select="($which-tests eq 'all' or $t04 eq 'on' or $t0414 eq 'on')"/>
					<xsl:variable name="test04" select="$test0401 or $test0402 or $test0403 or $test0404 or $test0405 or $test0406 or $test0407 or $test0408 or $test0409 or $test0410 or $test0411 or $test0412 or $test0413 or $test0414"/><!-- all test in 04-->
					
					<xsl:variable name="test05" select="'1' eq '2'"/><!-- all test in 05-->
					<xsl:variable name="test06" select="'1' eq '2'"/><!-- all test in 06-->
					<xsl:variable name="test07" select="'1' eq '2'"/><!-- all test in 07-->
					<xsl:variable name="test08" select="'1' eq '2'"/><!-- all test in 08-->
					<xsl:variable name="test09" select="'1' eq '2'"/><!-- all test in 09-->
					<xsl:variable name="test10" select="'1' eq '2'"/><!-- all test in 10-->
					<xsl:variable name="test11" select="'1' eq '2'"/><!-- all test in 11-->
					<xsl:variable name="test12" select="'1' eq '2'"/><!-- all test in 12-->
					<xsl:variable name="test13" select="'1' eq '2'"/><!-- all test in 13-->
					<xsl:variable name="test14" select="'1' eq '2'"/><!-- all test in 14-->
					<xsl:variable name="test15" select="'1' eq '2'"/><!-- all test in 15-->
					
					
					<!-- Show message about selected test.  -->
					<ctl:message select="concat('run 01.OWS Main: ',$test01)"/>
					<ctl:message select="concat('run 01.01.OWS.ContentType.1: ',$test0101)"/>
					<ctl:message select="concat('run 01.02.OWS.GetCapabilities-Exceptions.2: ',$test0102)"/>
					<ctl:message select="concat('run 01.03.OWS.GetCapabilities-UpdateSequence.1: ',$test0103)"/>
					<ctl:message select="concat('run 01.04.OWS.GetCapabilities-Exceptions.5: ',$test0104)"/>
					<ctl:message select="concat('run 01.05.OWS.CaseInsensitiveKvpNames.1: ',$test0105)"/>
					<ctl:message select="concat('run 01.06.OWS.GetCapabilities-AcceptVersions.1: ',$test0106)"/>
					<ctl:message select="concat('run 01.07.OWS.GetCapabilities-AcceptVersions.2: ',$test0107)"/>
					<ctl:message select="concat('run 01.08.OWS.GetCapabilities-AcceptVersions.3: ',$test0108)"/>
					<ctl:message select="concat('run 01.09.OWS.GetCapabilities-Sections.1: ',$test0109)"/>
					<ctl:message select="concat('run 01.10.OWS.GetCapabilities-Sections.2: ',$test0110)"/>
					<ctl:message select="concat('run 01.11.OWS.GetCapabilities-AcceptFormats.1: ',$test0111)"/>
					
					<ctl:message select="concat('run 02.SOS General Main: ',$test02)"/>
					<ctl:message select="concat('run 02.01.SOS.General-InvalidRequest.1: ',$test0201)"/>
					
					<ctl:message select="concat('run 03.SOS Core: Get Capabilities: ',$test03)"/>
					<ctl:message select="concat('run 03.01.CorrectServiceParameter: ',$test0301)"/>
					<ctl:message select="concat('run 03.02.OperationMetadataMandatory: ',$test0302)"/>
					<ctl:message select="concat('run 03.03.RequiredSectionsInCapabilities: ',$test0303)"/>
					<ctl:message select="concat('run 03.04.WrongSectionParameter: ',$test0304)"/>
					<ctl:message select="concat('run 03.05.BBOX: ',$test0305)"/>
					<ctl:message select="concat('run 03.06.OperatorDuringAndTEquals: ',$test0306)"/>
					<ctl:message select="concat('run 03.07.ParametersInObservationOffering: ',$test0307)"/>
					<ctl:message select="concat('run 03.08.ResponseFormat: ',$test0308)"/>
					
					<ctl:message select="concat('run 04.SOS Core: DescribeSensor: ',$test04)"/>
					<ctl:message select="concat('run 04.01.RequestNoService: ',$test0401)"/>
					<ctl:message select="concat('run 04.02.RequestNullService: ',$test0402)"/>
					<ctl:message select="concat('run 04.03.RequestInvalidService: ',$test0403)"/>
					<ctl:message select="concat('run 04.04.RequestNoVersion: ',$test0404)"/>
					<ctl:message select="concat('run 04.05.RequestNullVersion: ',$test0405)"/>
					<ctl:message select="concat('run 04.06.RequestInvalidVersion: ',$test0406)"/>
					<ctl:message select="concat('run 04.07.RequestNoProcedure: ',$test0407)"/>
					<ctl:message select="concat('run 04.08.RequestNullProcedure: ',$test0408)"/>
					<ctl:message select="concat('run 04.09.RequestInvalidProcedure: ',$test0409)"/>
					<ctl:message select="concat('run 04.10.RequestNoProcedureDescriptionFormat: ',$test0410)"/>
					<ctl:message select="concat('run 04.11.RequestNullProcedureDescriptionFormat: ',$test0411)"/>
					<ctl:message select="concat('run 04.12.RequestInvalidProcedureDescriptionFormat: ',$test0412)"/>
					<ctl:message select="concat('run 04.13.RequestNoValidTime: ',$test0413)"/>
					<ctl:message select="concat('run 04.14.RequestValidRequest: ',$test0414)"/>
						
					<ctl:message select="concat('run 05.SOS Core: GetObservation: ',$test05)"/>
					
					<ctl:message select="concat('run 06.SOS enhancedOperations: GetFeatureOfInterest: ',$test06)"/>
					
					<ctl:message select="concat('run 07.SOS enhancedOperations: GetObservationById: ',$test07)"/>
					
					<ctl:message select="concat('run 08.SOS Transactional: InsertionCapabilities: ',$test08)"/>
					
					<ctl:message select="concat('run 09.SOS Transactional: InsertSensor: ',$test09)"/>
					
					<ctl:message select="concat('run 10.SOS Transactional: DeleteSensor: ',$test10)"/>
					
					<ctl:message select="concat('run 11.SOS Transactional: InsertObservation: ',$test11)"/>
					
					<ctl:message select="concat('run 12.SOS resultHandling: InsertResultTemplate: ',$test12)"/>
					
					<ctl:message select="concat('run 13.SOS resultHandling: InsertResult: ',$test13)"/>
					
					<ctl:message select="concat('run 14.SOS resultRetrieval: GetResultTemplate: ',$test14)"/>
					
					<ctl:message select="concat('run 15.SOS resultRetrieval: GetResult: ',$test15)"/>
					
					<!-- set other "global" variables -->			
					<xsl:variable name="ogc.schema.root" select="'xsd/ogc/'"/>
					<xsl:variable name="sos.schema.root" select="$ogc.schema.root"/>

					<xsl:variable name="sos.version" select="'2.0.0'"/>		
					<xsl:variable name="ows.version" select="'1.1.0'"/>
					<xsl:variable name="exceptionReportSchema" select="sosFunctions:exceptionReportSchemaPath($ogc.schema.root, $ows.version)"/>


					<!-- 分類測試 -->
					<xsl:if test="$test01">
						<ctl:message>***************************</ctl:message>
						<ctl:message>Running OWS Common Tests...</ctl:message>
						<ctl:message>***************************</ctl:message>
						<ctl:call-test name="owsTests:ows-main">
							<ctl:with-param name="serviceURL" select="$GetCapabilities-URL"/>
							<ctl:with-param name="isGET" select="$IsGetCapabilities-GET"/>
							<ctl:with-param name="isSOAP" select="$isSOAP"/>
							<ctl:with-param name="serviceType" select="string('SOS')"/>
							<ctl:with-param name="serviceVersion" select="$sos.version" />
							<ctl:with-param name="capabilitiesRootElementName" select="string('Capabilities')" />
							<ctl:with-param name="capabilitiesResponseSchemaLocation" select="sosFunctions:schemaPath($sos.schema.root, $sos.version,'sos', 'sosGetCapabilities.xsd')"/>
							<ctl:with-param name="capabilitiesResponseSchemaType" select="string('resource')" />
							<ctl:with-param name="capabilitiesResponseContentType" select="string('text/xml')" />
							<ctl:with-param name="exceptionReportSchemaLocation" select="$exceptionReportSchema"/>
							<ctl:with-param name="exceptionReportSchemaType" select="string('resource')" />
							<ctl:with-param name="test0101" select="$test0101"/>
							<ctl:with-param name="test0102" select="$test0102"/>
							<ctl:with-param name="test0103" select="$test0103"/>
							<ctl:with-param name="test0104" select="$test0104"/>
							<ctl:with-param name="test0105" select="$test0105"/>
							<ctl:with-param name="test0106" select="$test0106"/>
							<ctl:with-param name="test0107" select="$test0107"/>
							<ctl:with-param name="test0108" select="$test0108"/>
							<ctl:with-param name="test0109" select="$test0109"/>
							<ctl:with-param name="test0110" select="$test0110"/>
							<ctl:with-param name="test0111" select="$test0111"/>
						</ctl:call-test>
					</xsl:if>

					<xsl:if test="$test02">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running General SOS Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
						<ctl:call-test name="sos:general-main">
							<ctl:with-param name="serviceURL" select="$GetCapabilities-URL" />
							<ctl:with-param name="isGET" select="$IsGetCapabilities-GET"/>
							<ctl:with-param name="isSOAP" select="$isSOAP"/>
							<ctl:with-param name="exceptionReportSchema" select="$exceptionReportSchema" />
							<ctl:with-param name="test0201" select="$test0201"/>
						</ctl:call-test>			
					</xsl:if>

					<xsl:if test="$test03">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 03.SOS Core: Get Capabilities Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
						<ctl:call-test name="sos:GetCapabilities-Test">
							<ctl:with-param name="serviceURL" select="$GetCapabilities-URL"/>
							<ctl:with-param name="isGET" select="$IsGetCapabilities-GET"/>
							<ctl:with-param name="isSOAP" select="$isSOAP"/>
							<ctl:with-param name="serviceType" select="string('SOS')"/>
							<ctl:with-param name="serviceVersion" select="$sos.version" />
							<ctl:with-param name="capabilitiesRootElementName" select="string('Capabilities')" />
							<ctl:with-param name="capabilitiesResponseSchemaLocation" select="sosFunctions:schemaPath($sos.schema.root, $sos.version,'sos', 'sosGetCapabilities.xsd')"/>
							<ctl:with-param name="capabilitiesResponseSchemaType" select="string('resource')" />
							<ctl:with-param name="capabilitiesResponseContentType" select="string('text/xml')" />
							<ctl:with-param name="exceptionReportSchemaLocation" select="$exceptionReportSchema"/>
							<ctl:with-param name="exceptionReportSchemaType" select="string('resource')" />
							<ctl:with-param name="test0301" select="$test0301"/>
							<ctl:with-param name="test0302" select="$test0302"/>
							<ctl:with-param name="test0303" select="$test0303"/>
							<ctl:with-param name="test0304" select="$test0304"/>
							<ctl:with-param name="test0305" select="$test0305"/>
							<ctl:with-param name="test0306" select="$test0306"/>
							<ctl:with-param name="test0307" select="$test0307"/>
							<ctl:with-param name="test0308" select="$test0308"/>
						</ctl:call-test>
					</xsl:if>
					
					<xsl:if test="$test04">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 04.SOS Core: DescribeSensor Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
						<ctl:call-test name="sos:DescribeSensor-Test">
							<ctl:with-param name="serviceURL" select="$DescribeSensor-URL"/>
							<ctl:with-param name="isGET" select="$IsDescribeSensor-GET"/>
							<ctl:with-param name="isSOAP" select="$isSOAP"/>
							<ctl:with-param name="getCapabilitiesResponse" select="$user-capabilities" />
							<ctl:with-param name="test0401" select="$test0401"/>
							<ctl:with-param name="test0402" select="$test0402"/>
							<ctl:with-param name="test0403" select="$test0403"/>
							<ctl:with-param name="test0404" select="$test0404"/>
							<ctl:with-param name="test0405" select="$test0405"/>
							<ctl:with-param name="test0406" select="$test0406"/>
							<ctl:with-param name="test0407" select="$test0407"/>
							<ctl:with-param name="test0408" select="$test0408"/>
							<ctl:with-param name="test0409" select="$test0409"/>
							<ctl:with-param name="test0410" select="$test0410"/>
							<ctl:with-param name="test0411" select="$test0411"/>
							<ctl:with-param name="test0412" select="$test0412"/>
							<ctl:with-param name="test0413" select="$test0413"/>
							<ctl:with-param name="test0414" select="$test0414"/>
						</ctl:call-test>
					</xsl:if>
					<xsl:if test="$test05">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 05.SOS Core: GetObservation Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test06">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 06.SOS enhancedOperations: GetFeatureOfInterest Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test07">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 07.SOS enhancedOperations: GetObservationById Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test08">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 08.SOS Transactional: InsertionCapabilities Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test09">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 09.SOS Transactional: InsertSensor Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test10">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 10.SOS Transactional: DeleteSensor Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test11">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 11.SOS Transactional: InsertObservation Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test12">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 12.SOS resultHandling: InsertResultTemplate Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test13">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 13.SOS resultHandling: InsertResult Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test14">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 14.SOS resultRetrieval: GetResultTemplate Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
					<xsl:if test="$test15">
						<ctl:message>****************************</ctl:message>
						<ctl:message>Running 15.SOS resultRetrieval: GetResult Tests...</ctl:message>
						<ctl:message>****************************</ctl:message>
					</xsl:if>
				</xsl:otherwise>
			</xsl:choose>
		</ctl:code>
	</ctl:test>

	<!-- 02.SOS General Main -->
	<ctl:package>
		<ctl:test name="sos:general-main">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="exceptionReportSchema" />
			<ctl:param name="test0201" />
			<ctl:assertion>All assertions for "general" conformance are satisfied.</ctl:assertion>
			<ctl:comment>Test driver for the general module.</ctl:comment>
			<ctl:code>
				<ctl:message select="concat('run 02.01.SOS.General-InvalidRequest.1: ',$test0201)"/>
				<xsl:if test="$test0201 eq 'true'">
					<ctl:message select="'******************** test0201 sos:general-SOS.General-InvalidRequest.1 ********************'"/>
					<ctl:call-test name="sos:general-SOS.General-InvalidRequest.1">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="exceptionReportSchema" select="$exceptionReportSchema" />
					</ctl:call-test>
				</xsl:if>
			</ctl:code>
		</ctl:test>
		<ctl:test name="sos:general-SOS.General-InvalidRequest.1">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="exceptionReportSchema" />
			<ctl:assertion>Sending a request that is non-conformant to a schema associated with an SOS operation causes the server to return a valid error report message with an exceptionCode value of MissingParameterValue.</ctl:assertion>
			<ctl:comment>Send several test documents that are invalid according to the schemas associated with some of the SOS operations (i.e. the mandatory operations). Pass if the service returns a valid exception message with an exceptionCode value of InvalidParamterValue; fail otherwise.</ctl:comment>
			<ctl:link title="Verify that an invalid request produces an appropriate response from the server.">docs/sos/1.0/SOS 1.0 ATS.html#SOS.General-InvalidRequest</ctl:link>
			<ctl:code>
				<!--
                    1.)  Issue several invalid request documents to the service.
                    2.)  Validate the response against the ExceptionReport schema.
                    3.)  If the response validates, then check that the exceptionCode value is "MissingParameterValue", not "InvalidRequest" (which is not specified as a valid exception code by the SOS spec)
                -->
				<ctl:message>Issuing an invalid request to:  <xsl:value-of select="$serviceURL" /></ctl:message>		     
				<ctl:message select="'The body of the request will be &quot;test&quot;'"/>
				<xsl:variable name="invalidRequestResponse">
					<xsl:choose>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:body>test</ctl:body>
								<parsers:SOAPParser return="content">
									<parsers:XMLValidatingParser>
										<parsers:schemas>
											<parsers:schema>
												<xsl:attribute name="type"><xsl:value-of select="'resource'" /></xsl:attribute>
												<xsl:value-of select="$exceptionReportSchema" />
											</parsers:schema>
										</parsers:schemas>
									</parsers:XMLValidatingParser>
								</parsers:SOAPParser>
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>test</ctl:body>
								<ctl:call-function name="sosFunctions:xmlValidatingParser">	
									<ctl:with-param name="schemaFile" select="$exceptionReportSchema"/>
								</ctl:call-function>
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
					
				</xsl:variable>        
				<xsl:choose>
					<xsl:when test="not($invalidRequestResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response to an invalid request or the response from the server was not a valid exception report.  The response from the server was:  "<xsl:copy-of select="$invalidRequestResponse/*" />"</ctl:message>
						<ctl:message select="concat('Schema file: ', $exceptionReportSchema)"/>
						<ctl:fail />
					</xsl:when>
					<xsl:otherwise>
						<ctl:message>The response was <xsl:value-of select="sosFunctions:getExceptionInfo($invalidRequestResponse)" /></ctl:message>
						<ctl:message>Checking the validity of the response to an invalid request.</ctl:message>
						<xsl:variable name="isCorrect">
							<ctl:call-function name="sosFunctions:checkExceptionReport">
								<ctl:with-param name="exceptionReport" select="$invalidRequestResponse" />
								<ctl:with-param name="exceptionCodeToCheck" select="string('MissingParameterValue')" />
								<ctl:with-param name="locatorToCheck" select="string('*')" />
								<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
							</ctl:call-function>
						</xsl:variable>
						<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
						<xsl:if test="not(xsd:boolean($isCorrect))">
							<ctl:message>FAILURE:  The response to an invalid request was expected to be an exception report with an exceptionCode of "MissingParameterValue" and a locator value containing the validation issue.  The returned exception report was:  "<xsl:value-of select="$invalidRequestResponse/*" />"</ctl:message>
							<ctl:message select="concat('Returned exception code was: &quot;', sosFunctions:exceptionCode($invalidRequestResponse), '&quot;')"/>
							<ctl:message select="'Expected exception code was: &quot;MissingParameterValue&quot;'"/>
							<ctl:fail />
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
	</ctl:package>

	<!-- 03.SOS Core: Get Capabilities -->
		<!-- 03 Send a valid GetCapailities (no parameters) ,Check the response (valid Capabilities) and pass the capabilities to other tests-->
	<ctl:package>
		<ctl:test name="sos:GetCapabilities-Test">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="serviceType" />
			<ctl:param name="serviceVersion" />
			<ctl:param name="capabilitiesRootElementName" />
			<ctl:param name="capabilitiesResponseSchemaLocation" />
			<ctl:param name="capabilitiesResponseSchemaType" />
			<ctl:param name="capabilitiesResponseContentType" />
			<ctl:param name="exceptionReportSchemaLocation" />
			<ctl:param name="exceptionReportSchemaType" />
			<ctl:param name="test0301" />
			<ctl:param name="test0302" />
			<ctl:param name="test0303" />
			<ctl:param name="test0304" />
			<ctl:param name="test0305" />
			<ctl:param name="test0306" />
			<ctl:param name="test0307" />
			<ctl:param name="test0308" />
			<ctl:assertion>All assertions for "GetCapabilities" conformance are satisfied.</ctl:assertion>
			<ctl:comment>Test driver for the GetCapabilities module.</ctl:comment>
			<ctl:code>
				<xsl:variable name="CapabilitiesResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">GetCapabilities</ctl:param>				   
								<parsers:XMLValidatingParser>
									<parsers:schemas>
										<parsers:schema type="resource">xsd/w3c/xml.xsd</parsers:schema>
										<parsers:schema>
											<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
											<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
										</parsers:schema>
									</parsers:schemas>
								</parsers:XMLValidatingParser>
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:body>
									<sos:GetCapabilities xmlns:sos="http://www.opengis.net/sos/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
										xsi:schemaLocation="http://www.w3.org/2003/05/soap-envelope http://www.w3.org/2003/05/soap-envelope/soap-envelope.xsd 
										http://www.opengis.net/sos/2.0 http://schemas.opengis.net/sos/2.0/sos.xsd"
										xmlns:soap12="http://www.w3.org/2003/05/soap-envelope" ></sos:GetCapabilities>
								</ctl:body>
								<parsers:SOAPParser return="content">
									<parsers:XMLValidatingParser>
										<parsers:schemas>
											<parsers:schema>
												<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
												<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
											</parsers:schema>
										</parsers:schemas>
									</parsers:XMLValidatingParser>
								</parsers:SOAPParser>
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<sos:GetCapabilities xmlns:sos="http://www.opengis.net/sos/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
										xsi:schemaLocation="http://www.w3.org/2003/05/soap-envelope http://www.w3.org/2003/05/soap-envelope/soap-envelope.xsd 
										http://www.opengis.net/sos/2.0 http://schemas.opengis.net/sos/2.0/sos.xsd"/>
								</ctl:body>
								<parsers:XMLValidatingParser>
									<parsers:schemas>
										<parsers:schema type="resource">xsd/w3c/xml.xsd</parsers:schema>
										<parsers:schema>
											<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
											<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
										</parsers:schema>
									</parsers:schemas>
								</parsers:XMLValidatingParser>
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($CapabilitiesResponse/*)">
						<ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<ctl:message select="concat('run 03.01.CorrectServiceParameter: ',$test0301)"/>
						<xsl:if test="$test0301 eq 'true'">
							<ctl:message select="'******************** 03.01.CorrectServiceParameter ********************'"/>
							<ctl:call-test name="sos:GCCorrectServiceParameter">
								<ctl:with-param name="serviceURL" select="$serviceURL" />
								<ctl:with-param name="isGET" select="$isGET"/>
								<ctl:with-param name="isSOAP" select="$isSOAP"/>
								<ctl:with-param name="capabilitiesRootElementName" select="$capabilitiesRootElementName" />
								<ctl:with-param name="capabilitiesResponseSchemaLocation" select="$capabilitiesResponseSchemaLocation" />
								<ctl:with-param name="capabilitiesResponseSchemaType" select="$capabilitiesResponseSchemaType" />
							</ctl:call-test>
						</xsl:if>
						<ctl:message select="concat('run 03.02.OperationMetadataMandatory: ',$test0302)"/>
						<xsl:if test="$test0302 eq 'true'">
							<ctl:message select="'******************** 03.02.OperationMetadataMandatory ********************'"/>
							<ctl:call-test name="sos:GCOperationMetadataMandatory">
								<ctl:with-param name="serviceURL" select="$serviceURL" />
								<ctl:with-param name="isGET" select="$isGET"/>
								<ctl:with-param name="isSOAP" select="$isSOAP"/>
								<ctl:with-param name="CapabilitiesResponse" select="$CapabilitiesResponse" />
							</ctl:call-test>
						</xsl:if>
						<ctl:message select="concat('run 03.03.RequiredSectionsInCapabilities: ',$test0303)"/>
						<xsl:if test="$test0303 eq 'true'">
							<ctl:message select="'******************** 03.03.RequiredSectionsInCapabilities ********************'"/>
							<ctl:call-test name="sos:GCRequiredSectionsInCapabilities">
								<ctl:with-param name="serviceURL" select="$serviceURL" />
								<ctl:with-param name="isGET" select="$isGET"/>
								<ctl:with-param name="isSOAP" select="$isSOAP"/>
								<ctl:with-param name="CapabilitiesResponse" select="$CapabilitiesResponse" />
							</ctl:call-test>
						</xsl:if>
						<ctl:message select="concat('run 03.04.WrongSectionParameter: ',$test0304)"/>
						<xsl:if test="$test0304 eq 'true'">
							<ctl:message select="'******************** 03.04.WrongSectionParameter ********************'"/>
							<ctl:call-test name="sos:GCWrongSectionParameter">
								<ctl:with-param name="serviceURL" select="$serviceURL" />
								<ctl:with-param name="isGET" select="$isGET"/>
								<ctl:with-param name="isSOAP" select="$isSOAP"/>
								<ctl:with-param name="capabilitiesRootElementName" select="$capabilitiesRootElementName" />
								<ctl:with-param name="capabilitiesResponseSchemaLocation" select="$capabilitiesResponseSchemaLocation" />
								<ctl:with-param name="capabilitiesResponseSchemaType" select="$capabilitiesResponseSchemaType" />
							</ctl:call-test>
						</xsl:if>
						<ctl:message select="concat('run 03.05.BBOX: ',$test0305)"/>
						<xsl:if test="$test0305 eq 'true'">
							<ctl:message select="'******************** 03.05.BBOX ********************'"/>
							<ctl:call-test name="sos:GCBBOX">
								<ctl:with-param name="serviceURL" select="$serviceURL" />
								<ctl:with-param name="isGET" select="$isGET"/>
								<ctl:with-param name="isSOAP" select="$isSOAP"/>
								<ctl:with-param name="CapabilitiesResponse" select="$CapabilitiesResponse" />
							</ctl:call-test>
						</xsl:if>
						<ctl:message select="concat('run 03.06.OperatorDuringAndTEquals: ',$test0306)"/>
						<xsl:if test="$test0306 eq 'true'">
							<ctl:message select="'******************** 03.06.OperatorDuringAndTEquals ********************'"/>
							<ctl:call-test name="sos:GCOperatorDuringAndTEquals">
								<ctl:with-param name="serviceURL" select="$serviceURL" />
								<ctl:with-param name="isGET" select="$isGET"/>
								<ctl:with-param name="isSOAP" select="$isSOAP"/>
								<ctl:with-param name="CapabilitiesResponse" select="$CapabilitiesResponse" />
							</ctl:call-test>
						</xsl:if>
						<ctl:message select="concat('run 03.07.ParametersInObservationOffering: ',$test0307)"/>
						<xsl:if test="$test0307 eq 'true'">
							<ctl:message select="'******************** 03.07.ParametersInObservationOffering ********************'"/>
							<ctl:call-test name="sos:GCParametersInObservationOffering">
								<ctl:with-param name="serviceURL" select="$serviceURL" />
								<ctl:with-param name="isGET" select="$isGET"/>
								<ctl:with-param name="isSOAP" select="$isSOAP"/>
								<ctl:with-param name="CapabilitiesResponse" select="$CapabilitiesResponse" />
							</ctl:call-test>
						</xsl:if>
						<ctl:message select="concat('run 03.08.ResponseFormat: ',$test0308)"/>
						<xsl:if test="$test0308 eq 'true'">
							<ctl:message select="'******************** 03.08.ResponseFormat ********************'"/>
							<ctl:call-test name="sos:GCResponseFormat">
								<ctl:with-param name="serviceURL" select="$serviceURL" />
								<ctl:with-param name="isGET" select="$isGET"/>
								<ctl:with-param name="isSOAP" select="$isSOAP"/>
								<ctl:with-param name="CapabilitiesResponse" select="$CapabilitiesResponse" />
							</ctl:call-test>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0301 Send GetCapabilities request with parameter service=SOS ,check the response is valid capabilities. -->
		<ctl:test name="sos:GCCorrectServiceParameter">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="capabilitiesRootElementName" />
			<ctl:param name="capabilitiesResponseSchemaLocation" />
			<ctl:param name="capabilitiesResponseSchemaType" />
			<ctl:assertion>
			The response to a GetCapabilities request that includes a service parameter
			with CORRECT VALUE provided shall include an complete capabilities document.
			</ctl:assertion>
			<ctl:comment>
			Pass if all of the following conditions are true:
				(1) the response is schema valid;
				(2) the root document matches the root element name.
			</ctl:comment>
			<ctl:code>
				<xsl:variable name="request">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">GetCapabilities</ctl:param>				   
								<ctl:param name="service"><xsl:value-of select="'SOS'" /></ctl:param>
								<parsers:XMLValidatingParser>
									<parsers:schemas>
										<parsers:schema type="resource">xsd/w3c/xml.xsd</parsers:schema>
										<parsers:schema>
											<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
											<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
										</parsers:schema>
									</parsers:schemas>
								</parsers:XMLValidatingParser>
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:body>
									<sos:GetCapabilities service="SOS" xmlns:sos="http://www.opengis.net/sos/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
										xsi:schemaLocation="http://www.w3.org/2003/05/soap-envelope http://www.w3.org/2003/05/soap-envelope/soap-envelope.xsd 
										http://www.opengis.net/sos/2.0 http://schemas.opengis.net/sos/2.0/sos.xsd"
										xmlns:soap12="http://www.w3.org/2003/05/soap-envelope" ></sos:GetCapabilities>
								</ctl:body>
								<parsers:SOAPParser return="content">
									<parsers:XMLValidatingParser>
										<parsers:schemas>
											<parsers:schema>
												<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
												<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
											</parsers:schema>
										</parsers:schemas>
									</parsers:XMLValidatingParser>
								</parsers:SOAPParser>
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<sos:GetCapabilities service="SOS" xmlns:sos="http://www.opengis.net/sos/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
										xsi:schemaLocation="http://www.w3.org/2003/05/soap-envelope http://www.w3.org/2003/05/soap-envelope/soap-envelope.xsd 
										http://www.opengis.net/sos/2.0 http://schemas.opengis.net/sos/2.0/sos.xsd"/>
								</ctl:body>
								<parsers:XMLValidatingParser>
									<parsers:schemas>
										<parsers:schema type="resource">xsd/w3c/xml.xsd</parsers:schema>
										<parsers:schema>
											<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
											<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
										</parsers:schema>
									</parsers:schemas>
								</parsers:XMLValidatingParser>
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>	
				<xsl:choose>
					<xsl:when test="not($request/*)">
						<ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:variable name="requestRoot" select="local-name-from-QName(node-name($request/*[1]))" />
						<xsl:choose>
							<xsl:when test="not($requestRoot=$capabilitiesRootElementName)">
								<ctl:message>FAILURE:  The root element from the response to a GetCapabilities request "<xsl:value-of select="$requestRoot" />" does not match the expected root element of "<xsl:value-of select="$capabilitiesRootElementName" />"</ctl:message>
								<ctl:fail />
							</xsl:when>
							<xsl:otherwise>
								<ctl:message>Passed.</ctl:message>
							</xsl:otherwise>
						</xsl:choose>
					</xsl:otherwise>
				</xsl:choose>	
			</ctl:code>
		</ctl:test>
		
		<!-- 0302 Check test03 Capabilities OperationMetadata must contain GetCapabilities DescribeSensor GetObservation operations -->
		<ctl:test name="sos:GCOperationMetadataMandatory">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="CapabilitiesResponse" />
			<ctl:assertion>There are three operations ,GetCapabilities DescribeSensor and GetObservation, in OperationMetadata in the Capabilities.</ctl:assertion>
			<ctl:comment>Pass if there are at least three operations in OperationMetadata Sections in the Capabilities.</ctl:comment>
			<ctl:code>
				<xsl:variable name="GetCapabilities" select="count($CapabilitiesResponse//ows:OperationsMetadata/ows:Operation[@name='GetCapabilities'])" />
				<xsl:variable name="DescribeSensor" select="count($CapabilitiesResponse//ows:OperationsMetadata/ows:Operation[@name='DescribeSensor'])" />
				<xsl:variable name="GetObservation" select="count($CapabilitiesResponse//ows:OperationsMetadata/ows:Operation[@name='GetObservation'])" />
				<xsl:choose>
					<xsl:when test="not($GetCapabilities=1)">
						<ctl:message>FAILURE: Mandatory Operation "GetCapabilities" Missed in OperationMetadata.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:when test="not($DescribeSensor=1)">
						<ctl:message>FAILURE: Mandatory Operation "DescribeSensor" Missed in OperationMetadata.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:when test="not($GetObservation=1)">
						<ctl:message>FAILURE: Mandatory Operation "GetObservation" Missed in OperationMetadata.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<ctl:message>Passed.</ctl:message>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0303 Check test03 Capabilities must have and only have those sections ServiceIdentification ,ServiceProvider ,OperationMetadata ,filter_Capabilities ,contents [,extension] -->
		<ctl:test name="sos:GCRequiredSectionsInCapabilities">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="CapabilitiesResponse" />
			<ctl:assertion>There are required sections,ServiceIdentification ServiceProvider OperationMetadata filter_Capabilities and contents in the Capabilities.</ctl:assertion>
			<ctl:comment>Pass if there are at least required sections in the Capabilities.</ctl:comment>
			<ctl:code>
				<xsl:variable name="ServiceIdentification" select="count($CapabilitiesResponse//ows:ServiceIdentification)" />
				<xsl:variable name="ServiceProvider" select="count($CapabilitiesResponse//ows:ServiceProvider)" />
				<xsl:variable name="OperationMetadata" select="count($CapabilitiesResponse//ows:OperationsMetadata)" />
				<xsl:variable name="filterCapabilities" select="count($CapabilitiesResponse//sos:filterCapabilities)" />
				<xsl:variable name="contents" select="count($CapabilitiesResponse//sos:contents)" />
				<xsl:choose>
					<xsl:when test="not($ServiceIdentification=1)">
						<ctl:message>FAILURE: Required section "ServiceIdentification" Missed in the Capabilities.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:when test="not($ServiceProvider=1)">
						<ctl:message>FAILURE: Required section "ServiceProvider" Missed in the Capabilities.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:when test="not($OperationMetadata=1)">
						<ctl:message>FAILURE: Required section "OperationMetadata" Missed in the Capabilities.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:when test="not($filterCapabilities=1)">
						<ctl:message>FAILURE: Required section "filterCapabilities" Missed in the Capabilities.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:when test="not($contents=1)">
						<ctl:message>FAILURE: Required section "contents" Missed in the Capabilities.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<ctl:message>Passed.</ctl:message>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0304 Send GetCapabilities request with section=WrongSections,server must return complete capabilities (by OWS 1.1.0 table 3) -->
		<ctl:test name="sos:GCWrongSectionParameter">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="capabilitiesRootElementName" />
			<ctl:param name="capabilitiesResponseSchemaLocation" />
			<ctl:param name="capabilitiesResponseSchemaType" />
			<ctl:assertion>
			The response to a GetCapabilities request that includes a sections parameter 
			with WRONG VALUE provided shall include an complete capabilities document.
			</ctl:assertion>
			<ctl:comment>
			Pass if the response is schema valid and contains all sections elements.
			</ctl:comment>
			<ctl:code>
				<xsl:variable name="request">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">GetCapabilities</ctl:param>				   
								<ctl:param name="sections">WrongSections</ctl:param>
								<parsers:XMLValidatingParser>
									<parsers:schemas>
										<parsers:schema type="resource">xsd/w3c/xml.xsd</parsers:schema>
										<parsers:schema>
											<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
											<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
										</parsers:schema>
									</parsers:schemas>
								</parsers:XMLValidatingParser>
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:body>
									<sos:GetCapabilities xmlns:sos="http://www.opengis.net/sos/2.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
										xsi:schemaLocation="http://www.w3.org/2003/05/soap-envelope http://www.w3.org/2003/05/soap-envelope/soap-envelope.xsd 
										http://www.opengis.net/sos/2.0 http://schemas.opengis.net/sos/2.0/sos.xsd"
										xmlns:soap12="http://www.w3.org/2003/05/soap-envelope" >
										<ows:Sections>
											<ows:Section>WrongSections</ows:Section>
										</ows:Sections>
									</sos:GetCapabilities>
								</ctl:body>
								<parsers:SOAPParser return="content">
									<parsers:XMLValidatingParser>
										<parsers:schemas>
											<parsers:schema>
												<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
												<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
											</parsers:schema>
										</parsers:schemas>
									</parsers:XMLValidatingParser>
								</parsers:SOAPParser>
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<sos:GetCapabilities xmlns:sos="http://www.opengis.net/sos/2.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
										xsi:schemaLocation="http://www.w3.org/2003/05/soap-envelope http://www.w3.org/2003/05/soap-envelope/soap-envelope.xsd 
										http://www.opengis.net/sos/2.0 http://schemas.opengis.net/sos/2.0/sos.xsd" >
										<ows:Sections>
											<ows:Section>WrongSections</ows:Section>
										</ows:Sections>
									</sos:GetCapabilities>
								</ctl:body>
								<parsers:XMLValidatingParser>
									<parsers:schemas>
										<parsers:schema type="resource">xsd/w3c/xml.xsd</parsers:schema>
										<parsers:schema>
											<xsl:attribute name="type"><xsl:value-of select="$capabilitiesResponseSchemaType" /></xsl:attribute>
											<xsl:value-of select="$capabilitiesResponseSchemaLocation" />
										</parsers:schema>
									</parsers:schemas>
								</parsers:XMLValidatingParser>
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>	
				<xsl:choose>
					<xsl:when test="not($request/*)">
						<ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<!-- 檢查是否所有sections都有 -->
						<xsl:variable name="CountServiceIdentification" select="count($request/*/ows:ServiceIdentification)" />
						<xsl:variable name="CountServiceProvider" select="count($request/*/ows:ServiceProvider)" />
						<xsl:variable name="CountOperationsMetadata" select="count($request/*/ows:OperationsMetadata)" />
						<xsl:variable name="CountfilterCapabilities" select="count($request/*/sos:filterCapabilities)" />
						<xsl:variable name="Countcontents" select="count($request/*/sos:contents)" />
						<xsl:choose>
							<xsl:when test="not($CountServiceIdentification=1)">
								<ctl:message>FAILURE: The Capabilities must contains section "ows:ServiceIdentification". </ctl:message>
								<ctl:fail />
							</xsl:when>
							<xsl:when test="not($CountServiceProvider=1)">
								<ctl:message>FAILURE: The Capabilities must contains section "ows:ServiceProvider". </ctl:message>
								<ctl:fail />
							</xsl:when>
							<xsl:when test="not($CountOperationsMetadata=1)">
								<ctl:message>FAILURE: The Capabilities must contains section "ows:OperationsMetadata". </ctl:message>
								<ctl:fail />
							</xsl:when>
							<xsl:when test="not($CountfilterCapabilities=1)">
								<ctl:message>FAILURE: The Capabilities must contains section "sos:filterCapabilities". </ctl:message>
								<ctl:fail />
							</xsl:when>
							<xsl:when test="not($Countcontents=1)">
								<ctl:message>FAILURE: The Capabilities must contains section "sos:contents". </ctl:message>
								<ctl:fail />
							</xsl:when>
							<xsl:otherwise>
								<ctl:message>Passed.</ctl:message>
							</xsl:otherwise>
						</xsl:choose>
					</xsl:otherwise>
				</xsl:choose>	
			</ctl:code>
		</ctl:test>
		
		<!-- 0305 Check test03 Capabilities <sos:filterCapabilities>/<fes:Filter_Capabilities>/<fes:Spatial_Capabilities>/<fes:SpatialOperators> must contain <fes:SpatialOperator name="BBOX"/> -->
		<ctl:test name="sos:GCBBOX">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="CapabilitiesResponse" />
			<ctl:assertion>
			The spatial operator BBOX is listed in the
			FilterCapabilities of the Capabilities document
			</ctl:assertion>
			<ctl:comment>
			Pass if the BBOX operator is listed in the FilterCapabilities section.
			</ctl:comment>
			<ctl:code>
				<xsl:variable name="BBOX" select="count($CapabilitiesResponse//sos:filterCapabilities/fes:Filter_Capabilities/fes:Spatial_Capabilities/fes:SpatialOperators/fes:SpatialOperator[@name='BBOX'])" />
				<xsl:choose>
					<xsl:when test="not($BBOX=1)">
						<ctl:message>FAILURE: The BBOX operator is not listed in the FilterCapabilities section.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<ctl:message>Passed.</ctl:message>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>

		<!-- 0306 Check test03 Capabilities <sos:filterCapabilities>/<fes:Filter_Capabilities>/<fes:Temporal_Capabilities>/<fes:TemporalOperators> must contain <fes:TemporalOperator name="During"/> and <fes:TemporalOperator name="TEquals"/> -->
		<ctl:test name="sos:GCOperatorDuringAndTEquals">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="CapabilitiesResponse" />
			<ctl:assertion>
			The During and TEquals TemporalOperators are listed in the
			FilterCapabilities of the Capabilities document.
			</ctl:assertion>
			<ctl:comment>
			Pass if the During and TEquals TemporalOperators are listed in the FilterCapabilities section.
			</ctl:comment>
			<ctl:code>
				<xsl:variable name="During" select="count($CapabilitiesResponse//sos:filterCapabilities/fes:Filter_Capabilities/fes:Temporal_Capabilities/fes:TemporalOperators/fes:TemporalOperator [@name='During'])" />
				<xsl:variable name="TEquals" select="count($CapabilitiesResponse//sos:filterCapabilities/fes:Filter_Capabilities/fes:Temporal_Capabilities/fes:TemporalOperators/fes:TemporalOperator [@name='TEquals'])" />
				<xsl:choose>
					<xsl:when test="not($During=1)">
						<ctl:message>FAILURE: The During TemporalOperator is not listed in the FilterCapabilities section.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:when test="not($TEquals=1)">
						<ctl:message>FAILURE: The TEquals TemporalOperator is not listed in the FilterCapabilities section.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<ctl:message>Passed.</ctl:message>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>

		<!-- 0307 Check test03 Capabilities Each ObservationOffering  
			Element 					count
			swes:identifier				1
			observableProperty			1..* - -maybe in Contents
			procedure 					1
			procedureDescriptionFormat 	1..* - -maybe in Contents
			observationType 			1..* - -maybe in Contents
			observedArea 				0..1
			phenomenonTime 				0..1
			responseFormat 				1..* - -maybe in Contents
			resultTime 					0..1 -->
		<ctl:test name="sos:GCParametersInObservationOffering">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="CapabilitiesResponse" />
			<ctl:assertion>
			Every elements in each observationOffering occur specified times.
			</ctl:assertion>
			<ctl:comment>
			Pass if all elements in each observationOffering or in Contents occur specified times.
			</ctl:comment>
			<ctl:code>
				<xsl:variable name="ContentsobservableProperty" select="count($CapabilitiesResponse//sos:Contents/swes:observableProperty)" />
				<xsl:variable name="ContentsprocedureDescriptionFormat" select="count($CapabilitiesResponse//sos:Contents/swes:procedureDescriptionFormat)" />
				<xsl:variable name="ContentsobservationType" select="count($CapabilitiesResponse//sos:Contents/sos:observationType)" />
				<xsl:variable name="ContentsresponseFormat" select="count($CapabilitiesResponse//sos:Contents/sos:responseFormat)" />
				<xsl:for-each select="$CapabilitiesResponse//sos:ObservationOffering">
					<ctl:message>1.identifier 1 </ctl:message>
					<xsl:variable name="identifier" select="./swes:identifier" />
					<ctl:message>identifier = <xsl:value-of select="$identifier"/></ctl:message>
					<xsl:variable name="identifierCount" select="count(./swes:identifier)" />
					<xsl:if test="not($identifierCount=1)">
						<ctl:message>FAILURE: Each ObservationOffering must contains one and only one identifier.</ctl:message>
						<ctl:fail/>
					</xsl:if>
					<ctl:message>2.observableProperty 1 or more than 1</ctl:message>
					<xsl:variable name="observablePropertyCount" select="count(./swes:observableProperty)" />
					<xsl:if test="($ContentsobservableProperty=0 and $observablePropertyCount=0)">
						<ctl:message>FAILURE: The Contents or Each ObservationOffering must contains one or more observableProperty.</ctl:message>
						<ctl:fail/>
					</xsl:if>
					<ctl:message>3.procedure 1</ctl:message>
					<xsl:variable name="procedureCount" select="count(./swes:procedure)" />
					<xsl:if test="not($procedureCount=1)">
						<ctl:message>FAILURE: Each ObservationOffering must contains one and only one procedure.</ctl:message>
						<ctl:fail/>
					</xsl:if>
					<ctl:message>4.procedureDescriptionFormat 1 or more than 1</ctl:message>
					<xsl:variable name="procedureDescriptionFormatCount" select="count(./swes:procedureDescriptionFormat)" />
					<xsl:if test="($ContentsprocedureDescriptionFormat=0 and $procedureDescriptionFormatCount=0)">
						<ctl:message>FAILURE: The Contents or Each ObservationOffering must contains one or more procedureDescriptionFormat.</ctl:message>
						<ctl:fail/>
					</xsl:if>
					<ctl:message>5.observationType 1 or more than 1</ctl:message>
					<xsl:variable name="observationTypeCount" select="count(./sos:observationType)" />
					<xsl:if test="($ContentsobservationType=0 and $observationTypeCount=0)">
						<ctl:message>FAILURE: The Contents or Each ObservationOffering must contains one or more observationType.</ctl:message>
						<ctl:fail/>
					</xsl:if>
					<ctl:message>6.observedArea 0 or 1</ctl:message>
					<xsl:variable name="observedAreaCount" select="count(./sos:observedArea)" />
					<xsl:if test="not($observedAreaCount=1 or $observedAreaCount=0)">
						<ctl:message>FAILURE: Each ObservationOffering must contains zero or one observedArea.</ctl:message>
						<ctl:fail/>
					</xsl:if>
					<ctl:message>7.phenomenonTime 0 or 1</ctl:message>
					<xsl:variable name="phenomenonTimeCount" select="count(./sos:phenomenonTime)" />
					<xsl:if test="not($phenomenonTimeCount=1 or $phenomenonTimeCount=0)">
						<ctl:message>FAILURE: Each ObservationOffering must contains zero or one phenomenonTime.</ctl:message>
						<ctl:fail/>
					</xsl:if>
					<ctl:message>8.responseFormat 1 or more than 1</ctl:message>
					<xsl:variable name="responseFormatCount" select="count(./sos:responseFormat)" />
					<xsl:if test="($ContentsresponseFormat=0 and $responseFormatCount=0)">
						<ctl:message>FAILURE: The Contents or Each ObservationOffering must contains one or more responseFormat.</ctl:message>
						<ctl:fail/>
					</xsl:if>
					<ctl:message>9.resultTime 0 or 1</ctl:message>
					<xsl:variable name="resultTimeCount" select="count(./sos:resultTime)" />
					<xsl:if test="not($resultTimeCount=1 or $resultTimeCount=0)">
						<ctl:message>FAILURE: Each ObservationOffering must contains zero or one resultTime.</ctl:message>
						<ctl:fail/>
					</xsl:if>
				</xsl:for-each>
			</ctl:code>
		</ctl:test>

		<!-- 0308 Check test03 Capabilities Each ObservationOffering the responseFormat must contain "http://www.opengis.net/om/2.0". -->
		<ctl:test name="sos:GCResponseFormat">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="CapabilitiesResponse" />
			<ctl:assertion>
			The responseFormat element which value is "http://www.opengis.net/om/2.0" is listed in the
			ObservationOffering or in the Contents of the Capabilities document.
			</ctl:assertion>
			<ctl:comment>
			Pass if the responseFormat element which value is "http://www.opengis.net/om/2.0" is listed in the ObservationOffering or Contents element.
			</ctl:comment>
			<ctl:code>
				<xsl:variable name="AllresponseFormat" select="count($CapabilitiesResponse//sos:Contents[sos:responseFormat='http://www.opengis.net/om/2.0']/sos:responseFormat)" />
				<xsl:choose>
					<xsl:when test="not($AllresponseFormat=1)">
						<xsl:for-each select="$CapabilitiesResponse//sos:ObservationOffering">
							<xsl:variable name="identifier" select="count(./swes:identifier)" />
							<xsl:variable name="responseFormat" select="count(.[sos:responseFormat='http://www.opengis.net/om/2.0']/sos:responseFormat)" />
							<xsl:if test="not($responseFormat=1)">
								<ctl:message>FAILURE: The ObservationOffering (identifier = <xsl:value-of select="$identifier"/>) must contain responseFormat which value is "http://www.opengis.net/om/2.0".</ctl:message>
								<ctl:fail/>
							</xsl:if>
						</xsl:for-each>
					</xsl:when>
					<xsl:otherwise>
						<ctl:message>Passed.</ctl:message>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>

	</ctl:package>
	
	<!-- 04.SOS Core: DescribeSensor -->
		<!-- 04 go each single test-->
	<ctl:package>
		<ctl:test name="sos:DescribeSensor-Test">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:param name="test0401" />
			<ctl:param name="test0402" />
			<ctl:param name="test0403" />
			<ctl:param name="test0404" />
			<ctl:param name="test0405" />
			<ctl:param name="test0406" />
			<ctl:param name="test0407" />
			<ctl:param name="test0408" />
			<ctl:param name="test0409" />
			<ctl:param name="test0410" />
			<ctl:param name="test0411" />
			<ctl:param name="test0412" />
			<ctl:param name="test0413" />
			<ctl:param name="test0414" />
			<ctl:assertion>Execute DescribeSensor Test.</ctl:assertion>
			<ctl:comment>Pass if all the subtest not fail; fail otherwise.</ctl:comment>
			<ctl:code>
				<xsl:if test="$test0401 eq 'true'">
					<ctl:message select="'******************** 04.01.RequestNoService ********************'"/>
					<ctl:call-test name="sos:DSRequestNoService">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0402 eq 'true'">
					<ctl:message select="'******************** 04.02.RequestNullService ********************'"/>
					<ctl:call-test name="sos:DSRequestNullService">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0403 eq 'true'">
					<ctl:message select="'******************** 04.03.RequestInvalidService ********************'"/>
					<ctl:call-test name="sos:DSRequestInvalidService">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0404 eq 'true'">
					<ctl:message select="'******************** 04.04.RequestNoVersion ********************'"/>
					<ctl:call-test name="sos:DSRequestNoVersion">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0405 eq 'true'">
					<ctl:message select="'******************** 04.05.RequestNullVersion ********************'"/>
					<ctl:call-test name="sos:DSRequestNullVersion">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0406 eq 'true'">
					<ctl:message select="'******************** 04.06.RequestInvalidVersion ********************'"/>
					<ctl:call-test name="sos:DSRequestInvalidVersion">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0407 eq 'true'">
					<ctl:message select="'******************** 04.07.RequestNoProcedure ********************'"/>
					<ctl:call-test name="sos:DSRequestNoProcedure">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0408 eq 'true'">
					<ctl:message select="'******************** 04.08.RequestNullProcedure ********************'"/>
					<ctl:call-test name="sos:DSRequestNullProcedure">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0409 eq 'true'">
					<ctl:message select="'******************** 04.09.RequestInvalidProcedure ********************'"/>
					<ctl:call-test name="sos:DSRequestInvalidProcedure">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0410 eq 'true'">
					<ctl:message select="'******************** 04.10.RequestNoProcedureDescriptionFormat ********************'"/>
					<ctl:call-test name="sos:DSRequestNoProcedureDescriptionFormat">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0411 eq 'true'">
					<ctl:message select="'******************** 04.11.RequestNullProcedureDescriptionFormat ********************'"/>
					<ctl:call-test name="sos:DSRequestNullProcedureDescriptionFormat">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0412 eq 'true'">
					<ctl:message select="'******************** 04.12.RequestInvalidProcedureDescriptionFormat ********************'"/>
					<ctl:call-test name="sos:DSRequestInvalidProcedureDescriptionFormat">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0413 eq 'true'">
					<ctl:message select="'******************** 04.13.RequestNoValidTime ********************'"/>
					<ctl:call-test name="sos:DSRequestNoValidTime">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
				<xsl:if test="$test0414 eq 'true'">
					<ctl:message select="'******************** 04.14.RequestValidRequest ********************'"/>
					<ctl:call-test name="sos:DSRequestValidRequest">
						<ctl:with-param name="serviceURL" select="$serviceURL" />
						<ctl:with-param name="isGET" select="$isGET"/>
						<ctl:with-param name="isSOAP" select="$isSOAP"/>
						<ctl:with-param name="getCapabilitiesResponse" select="$getCapabilitiesResponse" />
					</ctl:call-test>
				</xsl:if>
			</ctl:code>
		</ctl:test>
	
		<!-- 0401 Send DescribeSensor request without parameter service ,the response must be a valid exception with code "MissingParameterValue" and locator "service".. -->
		<ctl:test name="sos:DSRequestNoService">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request without parameter "service",and the response must be a valid exception with code "MissingParameterValue" and locator "service". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "MissingParameterValue" and locator is "service"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- get a valid procedure-->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="version">2.0.0</ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with no service parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('MissingParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('service')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with no service parameter specified. </ctl:message>
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "MissingParameterValue" and a locator of "service".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>

		<!-- 0402 Send DescribeSensor request with null parameter service ,the response must be a valid exception with code "InvalidParameterValue" and locator "service".. -->
		<ctl:test name="sos:DSRequestNullService">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with null parameter "service",and the response must be a valid exception with code "InvalidParameterValue" and locator "service". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "InvalidParameterValue" and locator is "service"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- 取得一個 procedure-->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('')" /></ctl:param>
								<ctl:param name="version">2.0.0</ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid service parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('InvalidParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('service')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with null service parameter specified.  </ctl:message>
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "InvalidParameterValue" and a locator of "service".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0403 Send DescribeSensor request with invalid parameter service ,the response must be a valid exception with code "InvalidParameterValue" and locator "service".. -->
		<ctl:test name="sos:DSRequestInvalidService">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with invalid parameter "procedure",and the response must be a valid exception with code "InvalidParameterValue" and locator "service". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "InvalidParameterValue" and locator is "service"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- 取得一個 procedure-->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('999')" /></ctl:param>
								<ctl:param name="version">2.0.0</ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="999" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="999" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid service parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('InvalidParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('service')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with invalid service parameter specified.  </ctl:message>
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "InvalidParameterValue" and a locator of "service".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0404 Send DescribeSensor request without parameter version ,the response must be a valid exception with code "MissingParameterValue" and locator "version".. -->
		<ctl:test name="sos:DSRequestNoVersion">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request without parameter "version",and the response must be a valid exception with code "MissingParameterValue" and locator "version". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "MissingParameterValue" and locator is "version"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- 取得一個 procedure-->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with no version parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('MissingParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('version')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with no version parameter specified.</ctl:message>  
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "MissingParameterValue" and a locator of "version".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0405 Send DescribeSensor request with null parameter version ,the response must be a valid exception with code "InvalidParameterValue" and locator "version".. -->
		<ctl:test name="sos:DSRequestNullVersion">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with null parameter "version",and the response must be a valid exception with code "InvalidParameterValue" and locator "version". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "InvalidParameterValue" and locator is "version"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- 取得一個 procedure-->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid version parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('InvalidParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('version')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with null version parameter specified. </ctl:message> 
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "InvalidParameterValue" and a locator of "version".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0406 Send DescribeSensor request with invalid parameter version ,the response must be a valid exception with code "InvalidParameterValue" and locator "version".. -->
		<ctl:test name="sos:DSRequestInvalidVersion">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with invalid parameter "version",and the response must be a valid exception with code "InvalidParameterValue" and locator "version". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "InvalidParameterValue" and locator is "version"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- 取得一個 procedure-->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('999')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="999" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="999" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid version parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('InvalidParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('version')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with invalid version parameter specified.</ctl:message>  
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "InvalidParameterValue" and a locator of "version".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0407 Send DescribeSensor request without parameter procedure ,the response must be a valid exception with code "MissingParameterValue" and locator "procedure".. -->
		<ctl:test name="sos:DSRequestNoProcedure">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request without parameter "procedure",and the response must be a valid exception with code "MissingParameterValue" and locator "procedure". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "MissingParameterValue" and locator is "procedure"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('2.0.0')" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with no procedure parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('MissingParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('procedure')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with no procedure parameter specified.  </ctl:message>
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "MissingParameterValue" and a locator of "procedure".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0408 Send DescribeSensor request with null parameter procedure ,the response must be a valid exception with code "InvalidParameterValue" and locator "procedure".. -->
		<ctl:test name="sos:DSRequestNullProcedure">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with null parameter "procedure",and the response must be a valid exception with code "InvalidParameterValue" and locator "procedure". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "InvalidParameterValue" and locator is "procedure"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- set a invalid procedure -->
				<xsl:variable name="procedure" select="string('')" />
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('2.0.0')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid procedure parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('InvalidParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('procedure')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with null procedure parameter specified.</ctl:message>  
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "InvalidParameterValue" and a locator of "procedure".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0409 Send DescribeSensor request with invalid parameter procedure ,the response must be a valid exception with code "InvalidParameterValue" and locator "procedure".. -->
		<ctl:test name="sos:DSRequestInvalidProcedure">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with invalid parameter "procedure",and the response must be a valid exception with code "InvalidParameterValue" and locator "procedure". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "InvalidParameterValue" and locator is "procedure"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- set a invalid procedure -->
				<xsl:variable name="procedure" select="current-dateTime()" />" />
				<!-- get procedureDescriptionFormat value first-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('2.0.0')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid procedure parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('InvalidParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('procedure')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with invalid procedure parameter specified.  </ctl:message>
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "InvalidParameterValue" and a locator of "procedure".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0410 Send DescribeSensor request without parameter ProcedureDescriptionFormat ,the response must be a valid exception with code "MissingParameterValue" and locator "ProcedureDescriptionFormat".. -->
		<ctl:test name="sos:DSRequestNoProcedureDescriptionFormat">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request without parameter "ProcedureDescriptionFormat",and the response must be a valid exception with code "MissingParameterValue" and locator "ProcedureDescriptionFormat". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "MissingParameterValue" and locator is "ProcedureDescriptionFormat"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- 取得一個 procedure-->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('2.0.0')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with no procedureDescriptionFormat parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('MissingParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('procedureDescriptionFormat')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with no procedureDescriptionFormat parameter specified. </ctl:message> 
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "MissingParameterValue" and a locator of "procedureDescriptionFormat".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0411 Send DescribeSensor request with null parameter ProcedureDescriptionFormat ,the response must be a valid exception with code "InvalidParameterValue" and locator "ProcedureDescriptionFormat".. -->
		<ctl:test name="sos:DSRequestNullProcedureDescriptionFormat">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with null parameter "ProcedureDescriptionFormat",and the response must be a valid exception with code "InvalidParameterValue" and locator "ProcedureDescriptionFormat". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "InvalidParameterValue" and locator is "ProcedureDescriptionFormat"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!--  get procedure value first -->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- set a invalid procedureDescriptionFormat -->
				<xsl:variable name="procedureDescriptionFormat" select="string('')" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('2.0.0')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid procedureDescriptionFormat parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('InvalidParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('procedureDescriptionFormat')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with null ProcedureDescriptionFormat parameter specified.  </ctl:message>
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "InvalidParameterValue" and a locator of "procedureDescriptionFormat".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0412 Send DescribeSensor request with invalid parameter ProcedureDescriptionFormat ,the response must be a valid exception with code "InvalidParameterValue" and locator "ProcedureDescriptionFormat".. -->
		<ctl:test name="sos:DSRequestInvalidProcedureDescriptionFormat">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with invalid parameter "ProcedureDescriptionFormat",and the response must be a valid exception with code "InvalidParameterValue" and locator "ProcedureDescriptionFormat". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "InvalidParameterValue" and locator is "ProcedureDescriptionFormat"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!--  get procedure value first -->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- set a invalid procedureDescriptionFormat -->
				<xsl:variable name="procedureDescriptionFormat" select="current-dateTime()" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('2.0.0')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid procedureDescriptionFormat parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('InvalidParameterValue')" />
									<ctl:with-param name="locatorToCheck" select="string('procedureDescriptionFormat')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with invalid procedureDescriptionFormat parameter specified.  </ctl:message>
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "InvalidParameterValue" and a locator of "procedureDescriptionFormat".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0413 Send DescribeSensor request with invalid parameter validTime = "123" ,the response must be a valid exception with code "OptionNotSupported" and locator "validTime".. -->
		<ctl:test name="sos:DSRequestNoValidTime">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a request with invalid parameter "validTime" value "123",and the response must be a valid exception with code "OptionNotSupported" and locator "validTime". </ctl:assertion>
			<ctl:comment>Pass if the server returns a valid exception message with an exceptionCode "OptionNotSupported" and locator is "validTime"; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- get procedure value-->
				<xsl:variable name="procedure" select="$getCapabilitiesResponse//sos:contents//swes:procedure" />
				<!-- get procedureDescriptionFormat value-->
				<xsl:variable name="procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents//swes:procedureDescriptionFormat" />
				<!-- set a invalid ValidTime -->
				<xsl:variable name="validTime" select="string('123')" />
				<!-- send request -->
				<xsl:variable name="describeSensorResponse">
					<xsl:choose>
						<xsl:when test="($isGET)">
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url>
								<ctl:method>get</ctl:method>
								<ctl:param name="request">DescribeSensor</ctl:param>
								<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
								<ctl:param name="version"><xsl:value-of select="String('2.0.0')" /></ctl:param>
								<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
								<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
								<ctl:param name="validTime"><xsl:value-of select="$validTime" /></ctl:param>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:when>
						<xsl:when test="($isSOAP)">
							<ctl:soap-request version="1.2" charset="UTF-8">
								<ctl:url>
									<xsl:value-of select="$serviceURL"/>
								</ctl:url> 
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
										<swes:validTime><xsl:value-of select="$validTime" /></swes:validTime>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReportSOAP" />
							</ctl:soap-request>
						</xsl:when>
						<xsl:otherwise>
							<ctl:request>
								<ctl:url>
									<xsl:value-of select="$serviceURL" />
								</ctl:url>
								<ctl:method>post</ctl:method>
								<ctl:body>
									<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
										<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
										<swes:validTime><xsl:value-of select="$validTime" /></swes:validTime>
									</swes:DescribeSensor>
								</ctl:body>
								<ctl:call-function name="sosFunctions:validateExceptionReport" />
							</ctl:request>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:variable>
				<xsl:choose>
					<xsl:when test="not($describeSensorResponse/*)">
						<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
						<ctl:fail/>
					</xsl:when>
					<xsl:otherwise>
						<xsl:if test="$describeSensorResponse/*">
							<xsl:if test="$isSOAP=string('true')">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfoSOAP($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<xsl:if test="not($isSOAP=string('true'))">
								<ctl:message>The response was:  <xsl:value-of select="sosFunctions:getExceptionInfo($describeSensorResponse)" /></ctl:message>
							</xsl:if>
							<ctl:message>Checking the validity of the response to a DescribeSensor request with invalid validTime parameter.</ctl:message>
							<xsl:variable name="isCorrect">
								<ctl:call-function name="sosFunctions:checkExceptionReport">
									<ctl:with-param name="exceptionReport" select="$describeSensorResponse" />
									<ctl:with-param name="exceptionCodeToCheck" select="string('OptionNotSupported')" />
									<ctl:with-param name="locatorToCheck" select="string('validTime')" />
									<ctl:with-param name="PostEncodingIsSOAP" select="$isSOAP" />
								</ctl:call-function>
							</xsl:variable>
							<ctl:message>The validity check returned:  <xsl:value-of select="$isCorrect" /></ctl:message>
							<xsl:if test="not(xsd:boolean($isCorrect))">
								<ctl:message>FAILURE:  The server did not return the expected exception report response to a DescribeSensor request with invalid validTime parameter specified. </ctl:message> 
								<ctl:message>The response was expected to be an ExceptionReport with an exceptionCode of "OptionNotSupported" and a locator of "validTime".</ctl:message>
								<ctl:fail />
							</xsl:if>
						</xsl:if>
					</xsl:otherwise>
				</xsl:choose>
			</ctl:code>
		</ctl:test>
		
		<!-- 0414 Send valid DescribeSensor request, the response must be a valid sensorML. -->
		<ctl:test name="sos:DSRequestValidRequest">
			<ctl:param name="serviceURL" />
			<ctl:param name="isGET" />
			<ctl:param name="isSOAP" />
			<ctl:param name="getCapabilitiesResponse" />
			<ctl:assertion>Send a valid request ,and there must be have a valid DescribeSensor response returned. </ctl:assertion>
			<ctl:comment>Pass if the DescribeSensor responses for all procedures listed in GetCapabilities response are valid; fail otherwise.</ctl:comment>
			<ctl:link title=""></ctl:link>
			<ctl:code>
				<!-- get the main procedureDescriptionFormat -->
				<xsl:variable name="main_procedureDescriptionFormat" select="$getCapabilitiesResponse//sos:contents/sos:SOSContents/swes:procedureDescriptionFormat" />
				<!-- check every offering -->
				<xsl:for-each select="$getCapabilitiesResponse//sos:contents/sos:SOSContents/swes:offering">
					<xsl:variable name="procedure" select="./sos:SensorOffering/swes:procedure" />
					<xsl:variable name="inner_procedureDescriptionFormat" select="./sos:SensorOffering/swes:observableProperty" />
					<xsl:variable name="procedureDescriptionFormat">
						<xsl:if test="$inner_procedureDescriptionFormat"><xsl:value-of select="$inner_procedureDescriptionFormat" /></xsl:if>
						<xsl:if test="not($inner_procedureDescriptionFormat)"><xsl:value-of select="$main_procedureDescriptionFormat" /></xsl:if>
					</xsl:variable>
					<!-- 對每個 procedure 發出request 檢查回應是否正確 (swes:DescribeSensorResponse 開頭,有相同的 procedureDescriptionFormat )-->
					<xsl:variable name="describeSensorResponse">
						<xsl:choose>
							<xsl:when test="($isGET)">
								<ctl:request>
									<ctl:url>
										<xsl:value-of select="$serviceURL"/>
									</ctl:url>
									<ctl:method>get</ctl:method>
									<ctl:param name="request">DescribeSensor</ctl:param>
									<ctl:param name="service"><xsl:value-of select="String('SOS')" /></ctl:param>
									<ctl:param name="version"><xsl:value-of select="String('2.0.0')" /></ctl:param>
									<ctl:param name="procedure"><xsl:value-of select="$procedure" /></ctl:param>
									<ctl:param name="procedureDescriptionFormat"><xsl:value-of select="$procedureDescriptionFormat" /></ctl:param>
									<ctl:call-function name="sosFunctions:validateExceptionReport" />
								</ctl:request>
							</xsl:when>
							<xsl:when test="($isSOAP)">
								<ctl:soap-request version="1.2" charset="UTF-8">
									<ctl:url>
										<xsl:value-of select="$serviceURL"/>
									</ctl:url> 
									<ctl:body>
										<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
											<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
											<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
										</swes:DescribeSensor>
									</ctl:body>
									<ctl:call-function name="sosFunctions:validateDescribeSensorResponseNoExceptionReportSOAP" />
								</ctl:soap-request>
							</xsl:when>
							<xsl:otherwise>
								<ctl:request>
									<ctl:url>
										<xsl:value-of select="$serviceURL" />
									</ctl:url>
									<ctl:method>post</ctl:method>
									<ctl:body>
										<swes:DescribeSensor service="SOS" version="2.0.0" xmlns:swes="http://www.opengis.net/swes/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
											<swes:procedure><xsl:value-of select="$procedure" /></swes:procedure>
											<swes:procedureDescriptionFormat><xsl:value-of select="$procedureDescriptionFormat" /></swes:procedureDescriptionFormat>
										</swes:DescribeSensor>
									</ctl:body>
									<ctl:call-function name="sosFunctions:validateDescribeSensorResponseNoExceptionReport" />
								</ctl:request>
							</xsl:otherwise>
						</xsl:choose>
					</xsl:variable>
					<xsl:choose>
						<xsl:when test="not($describeSensorResponse/*)">
							<ctl:message>FAILURE:  The server did not return a response, or the response was not valid according to the DescribeSensor response schema for "SOS" />.</ctl:message>
							<ctl:fail/>
						</xsl:when>
						<xsl:otherwise>
							<xsl:variable name="ResponseRoot" select="local-name-from-QName(node-name($describeSensorResponse/*[1]))" />
							<xsl:variable name="TargetRoot" select="string('DescribeSensorResponse')" />
							<!-- check procedureDescriptionFormat -->
							<xsl:variable name="RespnseFormat" select="$describeSensorResponse//swes:procedureDescriptionFormat" />
							<xsl:choose>
								<xsl:when test="not($ResponseRoot=$TargetRoot)">
									<ctl:message>The root element from the response to a DescribeSensor request "<xsl:value-of select="$ResponseRoot" />" does not match the expected root element of "<xsl:value-of select="$TargetRoot" />"</ctl:message>
									<ctl:fail />
								</xsl:when>
								<xsl:when test="not($procedureDescriptionFormat=$RespnseFormat)">
									<ctl:message>The procedureDescriptionFormat from the response to a DescribeSensor request :"<xsl:value-of select="$RespnseFormat" />does not match the procedureDescriptionFormat :"<xsl:value-of select="$procedureDescriptionFormat" />" in the DescribeSensor request.</ctl:message>
									<ctl:fail />
								</xsl:when>
								<xsl:otherwise>
									<ctl:message>procedure:"<xsl:value-of select="$procedure" />" check ok!</ctl:message>
								</xsl:otherwise>
							</xsl:choose>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:for-each>
			</ctl:code>
		</ctl:test>
		
	</ctl:package>

	<!-- 05.SOS Core: GetObservation -->
	<ctl:package>
	</ctl:package>

	<!-- 06.SOS enhancedOperations: GetFeatureOfInterest -->
	<ctl:package>
	</ctl:package>

	<!-- 07.SOS enhancedOperations: GetObservationById -->
	<ctl:package>
	</ctl:package>

	<!-- 08.SOS Transactional: InsertionCapabilities -->
	<ctl:package>
	</ctl:package>

	<!-- 09.SOS Transactional: InsertSensor -->
	<ctl:package>
	</ctl:package>

	<!-- 10.SOS Transactional: DeleteSensor -->
	<ctl:package>
	</ctl:package>

	<!-- 11.SOS Transactional: InsertObservation -->
	<ctl:package>
	</ctl:package>

	<!-- 12.SOS resultHandling: InsertResultTemplate -->
	<ctl:package>
	</ctl:package>

	<!-- 13.SOS resultHandling: InsertResult -->
	<ctl:package>
	</ctl:package>

	<!-- 14.SOS resultRetrieval: GetResultTemplate -->
	<ctl:package>
	</ctl:package>

	<!-- 15.SOS resultRetrieval: GetResult -->
	<ctl:package>
	</ctl:package>

	<!-- functions -->
	<ctl:package>
	<ctl:function name="sosFunctions:exceptionReportSchemaPath">
        <ctl:param name="schemaRoot">The location of the schemas</ctl:param>
		<ctl:param name="owsVersion">The numeric version of the schema</ctl:param>
		<ctl:code>			
			<xsl:value-of select="sosFunctions:schemaPath($schemaRoot, $owsVersion, 'ows', 'owsExceptionReport.xsd')"/>
		</ctl:code>
	</ctl:function>

	<ctl:function name="sosFunctions:schemaPath">
        <ctl:param name="schemaRoot">The location of the schemas</ctl:param>
		<ctl:param name="version">The numeric version of the schema</ctl:param>
		<ctl:param name="encoding">The name of the service or encoding to be used</ctl:param>
		<ctl:param name="filename">Filename of schema file</ctl:param>	
		<ctl:code>			
			<xsl:value-of select="concat($schemaRoot, $encoding, '/', $version, '/', $filename)"/>
		</ctl:code>
	</ctl:function> 

	<ctl:function name="sosFunctions:xmlValidatingParser">
        <ctl:param name="schemaFile">schemaFile</ctl:param>
		<ctl:description>Standard CTL XMLValidatingParser</ctl:description>
        <ctl:code>						
			<xsl:choose>
				<xsl:when test="starts-with($schemaFile,'http')">
					<parsers:XMLValidatingParser ignoreErrors="false">
						<parsers:schema type="resource">xsd/w3c/xml.xsd</parsers:schema>
						<xsl:if test="$schemaFile='xsd/ogc/om/1.0.0/om.xsd'">
							<parsers:schema type="resource">xsd/ogc/sampling/1.0.0/sampling.xsd</parsers:schema>
						</xsl:if>
						<parsers:schemas>
							<parsers:schema type="resource">
								<xsl:value-of select="$schemaFile"/>								
							</parsers:schema>							
							<parsers:schema type="resource">xsd/ogc/ows/1.1.0/owsExceptionReport.xsd</parsers:schema>	
						</parsers:schemas>
					</parsers:XMLValidatingParser>	
				</xsl:when>
				<xsl:otherwise>
					<parsers:XMLValidatingParser ignoreErrors="false">
						<parsers:schemas>
							<parsers:schema type="resource">xsd/w3c/xml.xsd</parsers:schema>						
							<parsers:schema type="resource">
								<xsl:value-of select="$schemaFile"/>
							</parsers:schema>						
						</parsers:schemas>
					</parsers:XMLValidatingParser>
				</xsl:otherwise>
			</xsl:choose>				
        </ctl:code>
    </ctl:function>

	
	<ctl:function name="sosFunctions:exceptionCode">
		<ctl:param name="exceptionResponse">The exception repsonse</ctl:param>
		<ctl:description>Return the @exceptionCode attribute of an ows:ExceptionReport </ctl:description>
		<ctl:code>
			<xsl:variable name="exceptionElement" select="sosFunctions:exceptionElement($exceptionResponse)"/>
			<xsl:value-of select="$exceptionElement/@exceptionCode" />
		</ctl:code>
	</ctl:function>

    <ctl:function name="sosFunctions:xmlValidatingParser">
        <ctl:param name="schemaRoot">The location of the schemas</ctl:param>
		<ctl:param name="version">The numeric version of the schema</ctl:param>
		<ctl:param name="encoding">The name of the service or encoding to be used</ctl:param>
		<ctl:param name="filename">Filenam of schema file</ctl:param>
		<ctl:description>Standard CTL XMLValidatingParser</ctl:description>
        <ctl:code>				
			<xsl:variable name="schemaFile" select="sosFunctions:schemaPath($schemaRoot, $version, $encoding, $filename)"/>
			<xsl:copy-of select="sosFunctions:xmlValidatingParser($schemaFile)"/>
        </ctl:code>
    </ctl:function>

	<ctl:function name="sosFunctions:exceptionElement">
		<ctl:param name="exceptionResponse">The exception repsonse</ctl:param>
		<ctl:description>Return the Exception element of an ows:ExceptionReport </ctl:description>
		<ctl:code>
			<xsl:copy-of select="$exceptionResponse//ows:ExceptionReport/ows:Exception" />
		</ctl:code>
	</ctl:function>
	
    <ctl:function name="sosFunctions:validateGetCapabilitiesResponseSOAP">
        <ctl:return>The GetCapabilitiesResponse document if it's valid</ctl:return>
        <ctl:description>Validates a GetCapabilitiesResponse document according to its schema</ctl:description>
        <ctl:code>
			<parsers:SOAPParser return="content">
				<parsers:XMLValidatingParser>
					<parsers:schemas>
						<parsers:schema type="resource">
							<xsl:value-of select="sosFunctions:getSchemaLocation(string('sosGetCapabilities.xsd'))" />
						</parsers:schema>
						<parsers:schema type="resource">
							<xsl:value-of select="sosFunctions:getSchemaLocation(string('owsExceptionReport.xsd'))" />
						</parsers:schema>
					</parsers:schemas>
				</parsers:XMLValidatingParser>
			</parsers:SOAPParser>
        </ctl:code>
    </ctl:function>
	
	<ctl:function name="sosFunctions:getSchemaLocation">
        <ctl:param name="schemaName">The name of the schema file for which the full path will be returned</ctl:param>
        <ctl:return>The full schema path</ctl:return>
        <ctl:description>Based on the provided schema name, this function returns the full URL to the schema document</ctl:description>
        <ctl:code>
            <xsl:variable name="schemaLocation" select="string('xsd/ogc/')" />
            <xsl:variable name="sosSchemaLocation" select="concat($schemaLocation,'sos/2.0.0/')" />
			<xsl:variable name="swesSchemaLocation" select="concat($schemaLocation,'swes/2.0/')" />
            <xsl:variable name="owsSchemaLocation" select="concat($schemaLocation,'ows/1.1.0/')" />
            <xsl:variable name="sensorMLSchemaLocation" select="concat($schemaLocation,'sensorML/1.0.1/')" />
            <xsl:variable name="tmlSchemaLocation" select="concat($schemaLocation,'tml/1.0.0/')" />
            <xsl:choose>
                <xsl:when test="starts-with($schemaName,'sos')">
                    <xsl:value-of select="concat($sosSchemaLocation,$schemaName)" />
                </xsl:when>
                <xsl:when test="starts-with($schemaName,'swes')">
                    <xsl:value-of select="concat($swesSchemaLocation,$schemaName)" />
                </xsl:when>
                <xsl:when test="starts-with($schemaName,'ows')">
                    <xsl:value-of select="concat($owsSchemaLocation,$schemaName)" />
                </xsl:when>
                <xsl:when test="starts-with($schemaName,'sensorML')">
                    <xsl:value-of select="concat($sensorMLSchemaLocation,$schemaName)" />
                </xsl:when>
                <xsl:when test="starts-with($schemaName,'tml')">
                    <xsl:value-of select="concat($tmlSchemaLocation,$schemaName)" />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:value-of select="$schemaLocation" />
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:function>
	
	<ctl:function name="sosFunctions:validateExceptionReport"><!-- CHECK OK -->
        <ctl:return>The exception report if it's valid</ctl:return>
        <ctl:description>Validates a returned exception report according to its schema and determines if it is an appropriate exception report for an SOS</ctl:description>
        <ctl:code>
			<parsers:XMLValidatingParser>
				<parsers:schemas>
					<parsers:schema type="resource">
						<xsl:value-of select="sosFunctions:getSchemaLocation(string('owsExceptionReport.xsd'))" />
					</parsers:schema>
				</parsers:schemas>
			</parsers:XMLValidatingParser>
        </ctl:code>
    </ctl:function>
	
    <ctl:function name="sosFunctions:validateExceptionReportSOAP">
        <ctl:return>The exception report if it's valid</ctl:return>
        <ctl:description>Validates a returned exception report according to its schema and determines if it is an appropriate exception report for an SOS</ctl:description>
        <ctl:code>
			<parsers:SOAPParser return="content">
				<parsers:XMLValidatingParser>
					<parsers:schemas>
						<parsers:schema type="resource">
							<xsl:value-of select="sosFunctions:getSchemaLocation(string('owsExceptionReport.xsd'))" />
						</parsers:schema>
					</parsers:schemas>
				</parsers:XMLValidatingParser>
			</parsers:SOAPParser>
        </ctl:code>
    </ctl:function>
	
	<!--Validates an ExceptionReport and checks for specific exceptionCode and locator values-->
    <ctl:function name="sosFunctions:checkExceptionReport"><!-- CHECK OK -->
        <ctl:param name="exceptionReport">The exception report to check</ctl:param>
        <ctl:param name="exceptionCodeToCheck">The exceptionCode to check</ctl:param>
        <ctl:param name="locatorToCheck">The locator to check (a * can be provided to indicate that any locator value is allowed)</ctl:param>
		<ctl:param name="PostEncodingIsSOAP">Encoding Type</ctl:param>
        <ctl:return>True/false depending on whether or not the exception report is valid</ctl:return>
        <ctl:description></ctl:description>
        <ctl:code>
			<xsl:if test="$PostEncodingIsSOAP=string('true')">
				<xsl:variable name="exceptionElement" select="$exceptionReport//soap12:Detail/ows:Exception" />
				<xsl:variable name="exceptionCodeValue" select="$exceptionElement/@exceptionCode" />
				<xsl:variable name="locatorValue" select="$exceptionElement/@locator" />
				<xsl:choose>
					<xsl:when test="$locatorToCheck='*'">
						<xsl:value-of select="$exceptionElement and ($exceptionCodeToCheck=$exceptionCodeValue) and (string-length(normalize-space($locatorValue))>=0)" />
					</xsl:when>
					<xsl:otherwise>
						<xsl:value-of select="$exceptionElement and ($exceptionCodeToCheck=$exceptionCodeValue) and (lower-case($locatorToCheck)=lower-case($locatorValue))" />
					</xsl:otherwise>
				</xsl:choose>
			</xsl:if>
			<xsl:if test="not($PostEncodingIsSOAP=string('true'))">
				<xsl:variable name="exceptionElement" select="$exceptionReport//ows:ExceptionReport/ows:Exception" />
				<xsl:variable name="exceptionCodeValue" select="$exceptionElement/@exceptionCode" />
				<xsl:variable name="locatorValue" select="$exceptionElement/@locator" />
				<xsl:choose>
					<xsl:when test="$locatorToCheck='*'">
						<xsl:value-of select="$exceptionElement and ($exceptionCodeToCheck=$exceptionCodeValue) and (string-length(normalize-space($locatorValue))>=0)" />
					</xsl:when>
					<xsl:otherwise>
						<xsl:value-of select="$exceptionElement and ($exceptionCodeToCheck=$exceptionCodeValue) and (lower-case($locatorToCheck)=lower-case($locatorValue))" />
					</xsl:otherwise>
				</xsl:choose>
			</xsl:if>
        </ctl:code>
    </ctl:function>
	
	<ctl:function name="sosFunctions:getExceptionInfo">
        <ctl:param name="exceptionReport">The exception report</ctl:param>
        <ctl:return>The Exception Code and Locator of an exception report</ctl:return>
        <ctl:code>
            <xsl:variable name="exceptionElement" select="$exceptionReport//ows:ExceptionReport/ows:Exception" />
            <xsl:variable name="exceptionCodeValue" select="$exceptionElement/@exceptionCode" />
            <xsl:variable name="locatorValue" select="$exceptionElement/@locator" />
            <xsl:value-of select="concat('Exception Report (exceptionCode, locator):  ',$exceptionCodeValue,',',$locatorValue)" />
        </ctl:code>
    </ctl:function>

	<ctl:function name="sosFunctions:getExceptionInfoSOAP"><!-- CHECK OK -->
        <ctl:param name="exceptionReport">The exception report to check</ctl:param>
        <ctl:return>True/false depending on whether or not the exception report is valid</ctl:return>
        <ctl:description></ctl:description>
        <ctl:code>
            <xsl:variable name="exceptionElement" select="$exceptionReport//soap12:Detail/ows:Exception" />
            <xsl:variable name="exceptionCodeValue" select="$exceptionElement/@exceptionCode" />
            <xsl:variable name="locatorValue" select="$exceptionElement/@locator" />
            <xsl:variable name="exceptionText" select="$exceptionElement//ows:ExceptionText" />
            <xsl:value-of select="concat('ExceptionReport (exceptionCode, locator):  ',$exceptionCodeValue,', ',$locatorValue,' - ',$exceptionText)" />
        </ctl:code>
    </ctl:function>
	</ctl:package>

</ctl:package>